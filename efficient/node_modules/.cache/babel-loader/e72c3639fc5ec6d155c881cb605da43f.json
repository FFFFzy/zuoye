{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/Z/Desktop/efficient/efficient/node_modules/@babel/runtime/helpers/interopRequireDefault.js\").default;\n\nvar _interopRequireWildcard = require(\"C:/Users/Z/Desktop/efficient/efficient/node_modules/@babel/runtime/helpers/interopRequireWildcard.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar zrUtil = _interopRequireWildcard(require(\"zrender/lib/core/util.js\"));\n\nvar _RoamController = _interopRequireDefault(require(\"./RoamController.js\"));\n\nvar roamHelper = _interopRequireWildcard(require(\"../../component/helper/roamHelper.js\"));\n\nvar _cursorHelper = require(\"../../component/helper/cursorHelper.js\");\n\nvar graphic = _interopRequireWildcard(require(\"../../util/graphic.js\"));\n\nvar _states = require(\"../../util/states.js\");\n\nvar _geoSourceManager = _interopRequireDefault(require(\"../../coord/geo/geoSourceManager.js\"));\n\nvar _component = require(\"../../util/component.js\");\n\nvar _labelStyle = require(\"../../label/labelStyle.js\");\n\nvar _innerStore = require(\"../../util/innerStore.js\");\n\nvar _decal = require(\"../../util/decal.js\");\n\nvar _Displayable = _interopRequireDefault(require(\"zrender/lib/graphic/Displayable.js\"));\n\nvar _model = require(\"../../util/model.js\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * Only these tags enable use `itemStyle` if they are named in SVG.\n * Other tags like <text> <tspan> <image> might not suitable for `itemStyle`.\n * They will not be considered to be styled until some requirements come.\n */\nvar OPTION_STYLE_ENABLED_TAGS = ['rect', 'circle', 'line', 'ellipse', 'polygon', 'polyline', 'path'];\nvar OPTION_STYLE_ENABLED_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS);\nvar STATE_TRIGGER_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar LABEL_HOST_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar mapLabelRaw = (0, _model.makeInner)();\n\nfunction getFixedItemStyle(model) {\n  var itemStyle = model.getItemStyle();\n  var areaColor = model.get('areaColor'); // If user want the color not to be changed when hover,\n  // they should both set areaColor and color to be null.\n\n  if (areaColor != null) {\n    itemStyle.fill = areaColor;\n  }\n\n  return itemStyle;\n} // Only stroke can be used for line.\n// Using fill in style if stroke not exits.\n// TODO Not sure yet. Perhaps a separate `lineStyle`?\n\n\nfunction fixLineStyle(styleHost) {\n  var style = styleHost.style;\n\n  if (style) {\n    style.stroke = style.stroke || style.fill;\n    style.fill = null;\n  }\n}\n\nvar MapDraw =\n/** @class */\nfunction () {\n  function MapDraw(api) {\n    var group = new graphic.Group();\n    this.uid = (0, _component.getUID)('ec_map_draw');\n    this._controller = new _RoamController.default(api.getZr());\n    this._controllerHost = {\n      target: group\n    };\n    this.group = group;\n    group.add(this._regionsGroup = new graphic.Group());\n    group.add(this._svgGroup = new graphic.Group());\n  }\n\n  MapDraw.prototype.draw = function (mapOrGeoModel, ecModel, api, fromView, payload) {\n    var isGeo = mapOrGeoModel.mainType === 'geo'; // Map series has data. GEO model that controlled by map series\n    // will be assigned with map data. Other GEO model has no data.\n\n    var data = mapOrGeoModel.getData && mapOrGeoModel.getData();\n    isGeo && ecModel.eachComponent({\n      mainType: 'series',\n      subType: 'map'\n    }, function (mapSeries) {\n      if (!data && mapSeries.getHostGeoModel() === mapOrGeoModel) {\n        data = mapSeries.getData();\n      }\n    });\n    var geo = mapOrGeoModel.coordinateSystem;\n    var regionsGroup = this._regionsGroup;\n    var group = this.group;\n    var transformInfo = geo.getTransformInfo();\n    var transformInfoRaw = transformInfo.raw;\n    var transformInfoRoam = transformInfo.roam; // No animation when first draw or in action\n\n    var isFirstDraw = !regionsGroup.childAt(0) || payload;\n\n    if (isFirstDraw) {\n      group.x = transformInfoRoam.x;\n      group.y = transformInfoRoam.y;\n      group.scaleX = transformInfoRoam.scaleX;\n      group.scaleY = transformInfoRoam.scaleY;\n      group.dirty();\n    } else {\n      graphic.updateProps(group, transformInfoRoam, mapOrGeoModel);\n    }\n\n    var isVisualEncodedByVisualMap = data && data.getVisual('visualMeta') && data.getVisual('visualMeta').length > 0;\n    var viewBuildCtx = {\n      api: api,\n      geo: geo,\n      mapOrGeoModel: mapOrGeoModel,\n      data: data,\n      isVisualEncodedByVisualMap: isVisualEncodedByVisualMap,\n      isGeo: isGeo,\n      transformInfoRaw: transformInfoRaw\n    };\n\n    if (geo.resourceType === 'geoJSON') {\n      this._buildGeoJSON(viewBuildCtx);\n    } else if (geo.resourceType === 'geoSVG') {\n      this._buildSVG(viewBuildCtx);\n    }\n\n    this._updateController(mapOrGeoModel, ecModel, api);\n\n    this._updateMapSelectHandler(mapOrGeoModel, regionsGroup, api, fromView);\n  };\n\n  MapDraw.prototype._buildGeoJSON = function (viewBuildCtx) {\n    var regionsGroupByName = this._regionsGroupByName = zrUtil.createHashMap();\n    var regionsInfoByName = zrUtil.createHashMap();\n    var regionsGroup = this._regionsGroup;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n    var data = viewBuildCtx.data;\n    var projection = viewBuildCtx.geo.projection;\n    var projectionStream = projection && projection.stream;\n\n    function transformPoint(point, project) {\n      if (project) {\n        // projection may return null point.\n        point = project(point);\n      }\n\n      return point && [point[0] * transformInfoRaw.scaleX + transformInfoRaw.x, point[1] * transformInfoRaw.scaleY + transformInfoRaw.y];\n    }\n\n    ;\n\n    function transformPolygonPoints(inPoints) {\n      var outPoints = []; // If projectionStream is provided. Use it instead of single point project.\n\n      var project = !projectionStream && projection && projection.project;\n\n      for (var i = 0; i < inPoints.length; ++i) {\n        var newPt = transformPoint(inPoints[i], project);\n        newPt && outPoints.push(newPt);\n      }\n\n      return outPoints;\n    }\n\n    function getPolyShape(points) {\n      return {\n        shape: {\n          points: transformPolygonPoints(points)\n        }\n      };\n    }\n\n    regionsGroup.removeAll(); // Only when the resource is GeoJSON, there is `geo.regions`.\n\n    zrUtil.each(viewBuildCtx.geo.regions, function (region) {\n      var regionName = region.name; // Consider in GeoJson properties.name may be duplicated, for example,\n      // there is multiple region named \"United Kindom\" or \"France\" (so many\n      // colonies). And it is not appropriate to merge them in geo, which\n      // will make them share the same label and bring trouble in label\n      // location calculation.\n\n      var regionGroup = regionsGroupByName.get(regionName);\n\n      var _a = regionsInfoByName.get(regionName) || {},\n          dataIdx = _a.dataIdx,\n          regionModel = _a.regionModel;\n\n      if (!regionGroup) {\n        regionGroup = regionsGroupByName.set(regionName, new graphic.Group());\n        regionsGroup.add(regionGroup);\n        dataIdx = data ? data.indexOfName(regionName) : null;\n        regionModel = viewBuildCtx.isGeo ? mapOrGeoModel.getRegionModel(regionName) : data ? data.getItemModel(dataIdx) : null;\n        regionsInfoByName.set(regionName, {\n          dataIdx: dataIdx,\n          regionModel: regionModel\n        });\n      }\n\n      var polygonSubpaths = [];\n      var polylineSubpaths = [];\n      zrUtil.each(region.geometries, function (geometry) {\n        // Polygon and MultiPolygon\n        if (geometry.type === 'polygon') {\n          var polys = [geometry.exterior].concat(geometry.interiors || []);\n\n          if (projectionStream) {\n            polys = projectPolys(polys, projectionStream);\n          }\n\n          zrUtil.each(polys, function (poly) {\n            polygonSubpaths.push(new graphic.Polygon(getPolyShape(poly)));\n          });\n        } // LineString and MultiLineString\n        else {\n          var points = geometry.points;\n\n          if (projectionStream) {\n            points = projectPolys(points, projectionStream, true);\n          }\n\n          zrUtil.each(points, function (points) {\n            polylineSubpaths.push(new graphic.Polyline(getPolyShape(points)));\n          });\n        }\n      });\n      var centerPt = transformPoint(region.getCenter(), projection && projection.project);\n\n      function createCompoundPath(subpaths, isLine) {\n        if (!subpaths.length) {\n          return;\n        }\n\n        var compoundPath = new graphic.CompoundPath({\n          culling: true,\n          segmentIgnoreThreshold: 1,\n          shape: {\n            paths: subpaths\n          }\n        });\n        regionGroup.add(compoundPath);\n        applyOptionStyleForRegion(viewBuildCtx, compoundPath, dataIdx, regionModel);\n        resetLabelForRegion(viewBuildCtx, compoundPath, regionName, regionModel, mapOrGeoModel, dataIdx, centerPt);\n\n        if (isLine) {\n          fixLineStyle(compoundPath);\n          zrUtil.each(compoundPath.states, fixLineStyle);\n        }\n      }\n\n      createCompoundPath(polygonSubpaths);\n      createCompoundPath(polylineSubpaths, true);\n    }); // Ensure children have been added to `regionGroup` before calling them.\n\n    regionsGroupByName.each(function (regionGroup, regionName) {\n      var _a = regionsInfoByName.get(regionName),\n          dataIdx = _a.dataIdx,\n          regionModel = _a.regionModel;\n\n      resetEventTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel, dataIdx);\n      resetTooltipForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n      resetStateTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n    }, this);\n  };\n\n  MapDraw.prototype._buildSVG = function (viewBuildCtx) {\n    var mapName = viewBuildCtx.geo.map;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    this._svgGroup.x = transformInfoRaw.x;\n    this._svgGroup.y = transformInfoRaw.y;\n    this._svgGroup.scaleX = transformInfoRaw.scaleX;\n    this._svgGroup.scaleY = transformInfoRaw.scaleY;\n\n    if (this._svgResourceChanged(mapName)) {\n      this._freeSVG();\n\n      this._useSVG(mapName);\n    }\n\n    var svgDispatcherMap = this._svgDispatcherMap = zrUtil.createHashMap();\n    var focusSelf = false;\n    zrUtil.each(this._svgGraphicRecord.named, function (namedItem) {\n      // Note that we also allow different elements have the same name.\n      // For example, a glyph of a city and the label of the city have\n      // the same name and their tooltip info can be defined in a single\n      // region option.\n      var regionName = namedItem.name;\n      var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n      var data = viewBuildCtx.data;\n      var svgNodeTagLower = namedItem.svgNodeTagLower;\n      var el = namedItem.el;\n      var dataIdx = data ? data.indexOfName(regionName) : null;\n      var regionModel = mapOrGeoModel.getRegionModel(regionName);\n\n      if (OPTION_STYLE_ENABLED_TAG_MAP.get(svgNodeTagLower) != null && el instanceof _Displayable.default) {\n        applyOptionStyleForRegion(viewBuildCtx, el, dataIdx, regionModel);\n      }\n\n      if (el instanceof _Displayable.default) {\n        el.culling = true;\n      } // We do not know how the SVG like so we'd better not to change z2.\n      // Otherwise it might bring some unexpected result. For example,\n      // an area hovered that make some inner city can not be clicked.\n\n\n      el.z2EmphasisLift = 0; // If self named:\n\n      if (!namedItem.namedFrom) {\n        // label should batter to be displayed based on the center of <g>\n        // if it is named rather than displayed on each child.\n        if (LABEL_HOST_MAP.get(svgNodeTagLower) != null) {\n          resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx, null);\n        }\n\n        resetEventTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx);\n        resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n        if (STATE_TRIGGER_TAG_MAP.get(svgNodeTagLower) != null) {\n          var focus_1 = resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n          if (focus_1 === 'self') {\n            focusSelf = true;\n          }\n\n          var els = svgDispatcherMap.get(regionName) || svgDispatcherMap.set(regionName, []);\n          els.push(el);\n        }\n      }\n    }, this);\n\n    this._enableBlurEntireSVG(focusSelf, viewBuildCtx);\n  };\n\n  MapDraw.prototype._enableBlurEntireSVG = function (focusSelf, viewBuildCtx) {\n    // It's a little complicated to support blurring the entire geoSVG in series-map.\n    // So do not suport it until some requirements come.\n    // At present, in series-map, only regions can be blurred.\n    if (focusSelf && viewBuildCtx.isGeo) {\n      var blurStyle = viewBuildCtx.mapOrGeoModel.getModel(['blur', 'itemStyle']).getItemStyle(); // Only suport `opacity` here. Because not sure that other props are suitable for\n      // all of the elements generated by SVG (especially for Text/TSpan/Image/... ).\n\n      var opacity_1 = blurStyle.opacity;\n\n      this._svgGraphicRecord.root.traverse(function (el) {\n        if (!el.isGroup) {\n          // PENDING: clear those settings to SVG elements when `_freeSVG`.\n          // (Currently it happen not to be needed.)\n          (0, _states.setDefaultStateProxy)(el);\n          var style = el.ensureState('blur').style || {}; // Do not overwrite the region style that already set from region option.\n\n          if (style.opacity == null && opacity_1 != null) {\n            style.opacity = opacity_1;\n          } // If `ensureState('blur').style = {}`, there will be default opacity.\n          // Enable `stateTransition` (animation).\n\n\n          el.ensureState('emphasis');\n        }\n      });\n    }\n  };\n\n  MapDraw.prototype.remove = function () {\n    this._regionsGroup.removeAll();\n\n    this._regionsGroupByName = null;\n\n    this._svgGroup.removeAll();\n\n    this._freeSVG();\n\n    this._controller.dispose();\n\n    this._controllerHost = null;\n  };\n\n  MapDraw.prototype.findHighDownDispatchers = function (name, geoModel) {\n    if (name == null) {\n      return [];\n    }\n\n    var geo = geoModel.coordinateSystem;\n\n    if (geo.resourceType === 'geoJSON') {\n      var regionsGroupByName = this._regionsGroupByName;\n\n      if (regionsGroupByName) {\n        var regionGroup = regionsGroupByName.get(name);\n        return regionGroup ? [regionGroup] : [];\n      }\n    } else if (geo.resourceType === 'geoSVG') {\n      return this._svgDispatcherMap && this._svgDispatcherMap.get(name) || [];\n    }\n  };\n\n  MapDraw.prototype._svgResourceChanged = function (mapName) {\n    return this._svgMapName !== mapName;\n  };\n\n  MapDraw.prototype._useSVG = function (mapName) {\n    var resource = _geoSourceManager.default.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      var svgGraphic = resource.useGraphic(this.uid);\n\n      this._svgGroup.add(svgGraphic.root);\n\n      this._svgGraphicRecord = svgGraphic;\n      this._svgMapName = mapName;\n    }\n  };\n\n  MapDraw.prototype._freeSVG = function () {\n    var mapName = this._svgMapName;\n\n    if (mapName == null) {\n      return;\n    }\n\n    var resource = _geoSourceManager.default.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      resource.freeGraphic(this.uid);\n    }\n\n    this._svgGraphicRecord = null;\n    this._svgDispatcherMap = null;\n\n    this._svgGroup.removeAll();\n\n    this._svgMapName = null;\n  };\n\n  MapDraw.prototype._updateController = function (mapOrGeoModel, ecModel, api) {\n    var geo = mapOrGeoModel.coordinateSystem;\n    var controller = this._controller;\n    var controllerHost = this._controllerHost; // @ts-ignore FIXME:TS\n\n    controllerHost.zoomLimit = mapOrGeoModel.get('scaleLimit');\n    controllerHost.zoom = geo.getZoom(); // roamType is will be set default true if it is null\n    // @ts-ignore FIXME:TS\n\n    controller.enable(mapOrGeoModel.get('roam') || false);\n    var mainType = mapOrGeoModel.mainType;\n\n    function makeActionBase() {\n      var action = {\n        type: 'geoRoam',\n        componentType: mainType\n      };\n      action[mainType + 'Id'] = mapOrGeoModel.id;\n      return action;\n    }\n\n    controller.off('pan').on('pan', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnPan(controllerHost, e.dx, e.dy);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        dx: e.dx,\n        dy: e.dy,\n        animation: {\n          duration: 0\n        }\n      }));\n    }, this);\n    controller.off('zoom').on('zoom', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnZoom(controllerHost, e.scale, e.originX, e.originY);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        zoom: e.scale,\n        originX: e.originX,\n        originY: e.originY,\n        animation: {\n          duration: 0\n        }\n      }));\n    }, this);\n    controller.setPointerChecker(function (e, x, y) {\n      return geo.containPoint([x, y]) && !(0, _cursorHelper.onIrrelevantElement)(e, api, mapOrGeoModel);\n    });\n  };\n  /**\n   * FIXME: this is a temporarily workaround.\n   * When `geoRoam` the elements need to be reset in `MapView['render']`, because the props like\n   * `ignore` might have been modified by `LabelManager`, and `LabelManager#addLabelsOfSeries`\n   * will subsequently cache `defaultAttr` like `ignore`. If do not do this reset, the modified\n   * props will have no chance to be restored.\n   * Note: this reset should be after `clearStates` in `renderSeries` becuase `useStates` in\n   * `renderSeries` will cache the modified `ignore` to `el._normalState`.\n   * TODO:\n   * Use clone/immutable in `LabelManager`?\n   */\n\n\n  MapDraw.prototype.resetForLabelLayout = function () {\n    this.group.traverse(function (el) {\n      var label = el.getTextContent();\n\n      if (label) {\n        label.ignore = mapLabelRaw(label).ignore;\n      }\n    });\n  };\n\n  MapDraw.prototype._updateMapSelectHandler = function (mapOrGeoModel, regionsGroup, api, fromView) {\n    var mapDraw = this;\n    regionsGroup.off('mousedown');\n    regionsGroup.off('click'); // @ts-ignore FIXME:TS resolve type conflict\n\n    if (mapOrGeoModel.get('selectedMode')) {\n      regionsGroup.on('mousedown', function () {\n        mapDraw._mouseDownFlag = true;\n      });\n      regionsGroup.on('click', function (e) {\n        if (!mapDraw._mouseDownFlag) {\n          return;\n        }\n\n        mapDraw._mouseDownFlag = false;\n      });\n    }\n  };\n\n  return MapDraw;\n}();\n\n;\n\nfunction applyOptionStyleForRegion(viewBuildCtx, el, dataIndex, regionModel) {\n  // All of the path are using `itemStyle`, becuase\n  // (1) Some SVG also use fill on polyline (The different between\n  // polyline and polygon is \"open\" or \"close\" but not fill or not).\n  // (2) For the common props like opacity, if some use itemStyle\n  // and some use `lineStyle`, it might confuse users.\n  // (3) Most SVG use <path>, where can not detect wether draw a \"line\"\n  // or a filled shape, so use `itemStyle` for <path>.\n  var normalStyleModel = regionModel.getModel('itemStyle');\n  var emphasisStyleModel = regionModel.getModel(['emphasis', 'itemStyle']);\n  var blurStyleModel = regionModel.getModel(['blur', 'itemStyle']);\n  var selectStyleModel = regionModel.getModel(['select', 'itemStyle']); // NOTE: DONT use 'style' in visual when drawing map.\n  // This component is used for drawing underlying map for both geo component and map series.\n\n  var normalStyle = getFixedItemStyle(normalStyleModel);\n  var emphasisStyle = getFixedItemStyle(emphasisStyleModel);\n  var selectStyle = getFixedItemStyle(selectStyleModel);\n  var blurStyle = getFixedItemStyle(blurStyleModel); // Update the itemStyle if has data visual\n\n  var data = viewBuildCtx.data;\n\n  if (data) {\n    // Only visual color of each item will be used. It can be encoded by visualMap\n    // But visual color of series is used in symbol drawing\n    // Visual color for each series is for the symbol draw\n    var style = data.getItemVisual(dataIndex, 'style');\n    var decal = data.getItemVisual(dataIndex, 'decal');\n\n    if (viewBuildCtx.isVisualEncodedByVisualMap && style.fill) {\n      normalStyle.fill = style.fill;\n    }\n\n    if (decal) {\n      normalStyle.decal = (0, _decal.createOrUpdatePatternFromDecal)(decal, viewBuildCtx.api);\n    }\n  } // SVG text, tspan and image can be named but not supporeted\n  // to be styled by region option yet.\n\n\n  el.setStyle(normalStyle);\n  el.style.strokeNoScale = true;\n  el.ensureState('emphasis').style = emphasisStyle;\n  el.ensureState('select').style = selectStyle;\n  el.ensureState('blur').style = blurStyle; // Enable blur\n\n  (0, _states.setDefaultStateProxy)(el);\n}\n\nfunction resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx, // If labelXY not provided, use `textConfig.position: 'inside'`\nlabelXY) {\n  var data = viewBuildCtx.data;\n  var isGeo = viewBuildCtx.isGeo;\n  var isDataNaN = data && isNaN(data.get(data.mapDimension('value'), dataIdx));\n  var itemLayout = data && data.getItemLayout(dataIdx); // In the following cases label will be drawn\n  // 1. In map series and data value is NaN\n  // 2. In geo component\n  // 3. Region has no series legendIcon, which will be add a showLabel flag in mapSymbolLayout\n\n  if (isGeo || isDataNaN || itemLayout && itemLayout.showLabel) {\n    var query = !isGeo ? dataIdx : regionName;\n    var labelFetcher = void 0; // Consider dataIdx not found.\n\n    if (!data || dataIdx >= 0) {\n      labelFetcher = mapOrGeoModel;\n    }\n\n    var specifiedTextOpt = labelXY ? {\n      normal: {\n        align: 'center',\n        verticalAlign: 'middle'\n      }\n    } : null; // Caveat: must be called after `setDefaultStateProxy(el);` called.\n    // because textContent will be assign with `el.stateProxy` inside.\n\n    (0, _labelStyle.setLabelStyle)(el, (0, _labelStyle.getLabelStatesModels)(regionModel), {\n      labelFetcher: labelFetcher,\n      labelDataIndex: query,\n      defaultText: regionName\n    }, specifiedTextOpt);\n    var textEl = el.getTextContent();\n\n    if (textEl) {\n      mapLabelRaw(textEl).ignore = textEl.ignore;\n\n      if (el.textConfig && labelXY) {\n        // Compute a relative offset based on the el bounding rect.\n        var rect = el.getBoundingRect().clone(); // Need to make sure the percent position base on the same rect in normal and\n        // emphasis state. Otherwise if using boundingRect of el, but the emphasis state\n        // has borderWidth (even 0.5px), the text position will be changed obviously\n        // if the position is very big like ['1234%', '1345%'].\n\n        el.textConfig.layoutRect = rect;\n        el.textConfig.position = [(labelXY[0] - rect.x) / rect.width * 100 + '%', (labelXY[1] - rect.y) / rect.height * 100 + '%'];\n      }\n    } // PENDING:\n    // If labelLayout is enabled (test/label-layout.html), el.dataIndex should be specified.\n    // But el.dataIndex is also used to determine whether user event should be triggered,\n    // where el.seriesIndex or el.dataModel must be specified. At present for a single el\n    // there is not case that \"only label layout enabled but user event disabled\", so here\n    // we depends `resetEventTriggerForRegion` to do the job of setting `el.dataIndex`.\n\n\n    el.disableLabelAnimation = true;\n  } else {\n    el.removeTextContent();\n    el.removeTextConfig();\n    el.disableLabelAnimation = null;\n  }\n}\n\nfunction resetEventTriggerForRegion(viewBuildCtx, eventTrigger, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx) {\n  // setItemGraphicEl, setHoverStyle after all polygons and labels\n  // are added to the rigionGroup\n  if (viewBuildCtx.data) {\n    // FIXME: when series-map use a SVG map, and there are duplicated name specified\n    // on different SVG elements, after `data.setItemGraphicEl(...)`:\n    // (1) all of them will be mounted with `dataIndex`, `seriesIndex`, so that tooltip\n    // can be triggered only mouse hover. That's correct.\n    // (2) only the last element will be kept in `data`, so that if trigger tooltip\n    // by `dispatchAction`, only the last one can be found and triggered. That might be\n    // not correct. We will fix it in future if anyone demanding that.\n    viewBuildCtx.data.setItemGraphicEl(dataIdx, eventTrigger);\n  } // series-map will not trigger \"geoselectchange\" no matter it is\n  // based on a declared geo component. Becuause series-map will\n  // trigger \"selectchange\". If it trigger both the two events,\n  // If users call `chart.dispatchAction({type: 'toggleSelect'})`,\n  // it not easy to also fire event \"geoselectchanged\".\n  else {\n    // Package custom mouse event for geo component\n    (0, _innerStore.getECData)(eventTrigger).eventData = {\n      componentType: 'geo',\n      componentIndex: mapOrGeoModel.componentIndex,\n      geoIndex: mapOrGeoModel.componentIndex,\n      name: regionName,\n      region: regionModel && regionModel.option || {}\n    };\n  }\n}\n\nfunction resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  if (!viewBuildCtx.data) {\n    graphic.setTooltipConfig({\n      el: el,\n      componentModel: mapOrGeoModel,\n      itemName: regionName,\n      // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n      itemTooltipOption: regionModel.get('tooltip')\n    });\n  }\n}\n\nfunction resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n  el.highDownSilentOnTouch = !!mapOrGeoModel.get('selectedMode'); // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n\n  var emphasisModel = regionModel.getModel('emphasis');\n  var focus = emphasisModel.get('focus');\n  (0, _states.toggleHoverEmphasis)(el, focus, emphasisModel.get('blurScope'), emphasisModel.get('disabled'));\n\n  if (viewBuildCtx.isGeo) {\n    (0, _states.enableComponentHighDownFeatures)(el, mapOrGeoModel, regionName);\n  }\n\n  return focus;\n}\n\nfunction projectPolys(rings, // Polygons include exterior and interiors. Or polylines.\ncreateStream, isLine) {\n  var polygons = [];\n  var curPoly;\n\n  function startPolygon() {\n    curPoly = [];\n  }\n\n  function endPolygon() {\n    if (curPoly.length) {\n      polygons.push(curPoly);\n      curPoly = [];\n    }\n  }\n\n  var stream = createStream({\n    polygonStart: startPolygon,\n    polygonEnd: endPolygon,\n    lineStart: startPolygon,\n    lineEnd: endPolygon,\n    point: function (x, y) {\n      // May have NaN values from stream.\n      if (isFinite(x) && isFinite(y)) {\n        curPoly.push([x, y]);\n      }\n    },\n    sphere: function () {}\n  });\n  !isLine && stream.polygonStart();\n  zrUtil.each(rings, function (ring) {\n    stream.lineStart();\n\n    for (var i = 0; i < ring.length; i++) {\n      stream.point(ring[i][0], ring[i][1]);\n    }\n\n    stream.lineEnd();\n  });\n  !isLine && stream.polygonEnd();\n  return polygons;\n}\n\nvar _default = MapDraw; // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n\nexports.default = _default;","map":{"version":3,"names":["OPTION_STYLE_ENABLED_TAGS","OPTION_STYLE_ENABLED_TAG_MAP","zrUtil","createHashMap","STATE_TRIGGER_TAG_MAP","concat","LABEL_HOST_MAP","mapLabelRaw","makeInner","getFixedItemStyle","model","itemStyle","getItemStyle","areaColor","get","fill","fixLineStyle","styleHost","style","stroke","MapDraw","api","group","graphic","Group","uid","getUID","_controller","RoamController","getZr","_controllerHost","target","add","_regionsGroup","_svgGroup","prototype","draw","mapOrGeoModel","ecModel","fromView","payload","isGeo","mainType","data","getData","eachComponent","subType","mapSeries","getHostGeoModel","geo","coordinateSystem","regionsGroup","transformInfo","getTransformInfo","transformInfoRaw","raw","transformInfoRoam","roam","isFirstDraw","childAt","x","y","scaleX","scaleY","dirty","updateProps","isVisualEncodedByVisualMap","getVisual","length","viewBuildCtx","resourceType","_buildGeoJSON","_buildSVG","_updateController","_updateMapSelectHandler","regionsGroupByName","_regionsGroupByName","regionsInfoByName","projection","projectionStream","stream","transformPoint","point","project","transformPolygonPoints","inPoints","outPoints","i","newPt","push","getPolyShape","points","shape","removeAll","each","regions","region","regionName","name","regionGroup","_a","dataIdx","regionModel","set","indexOfName","getRegionModel","getItemModel","polygonSubpaths","polylineSubpaths","geometries","geometry","type","polys","exterior","interiors","projectPolys","poly","Polygon","Polyline","centerPt","getCenter","createCompoundPath","subpaths","isLine","compoundPath","CompoundPath","culling","segmentIgnoreThreshold","paths","applyOptionStyleForRegion","resetLabelForRegion","states","resetEventTriggerForRegion","resetTooltipForRegion","resetStateTriggerForRegion","mapName","map","_svgResourceChanged","_freeSVG","_useSVG","svgDispatcherMap","_svgDispatcherMap","focusSelf","_svgGraphicRecord","named","namedItem","svgNodeTagLower","el","Displayable","z2EmphasisLift","namedFrom","focus_1","els","_enableBlurEntireSVG","blurStyle","getModel","opacity_1","opacity","root","traverse","isGroup","setDefaultStateProxy","ensureState","remove","dispose","findHighDownDispatchers","geoModel","_svgMapName","resource","geoSourceManager","getGeoResource","svgGraphic","useGraphic","freeGraphic","controller","controllerHost","zoomLimit","zoom","getZoom","enable","makeActionBase","action","componentType","id","off","on","e","_mouseDownFlag","roamHelper","updateViewOnPan","dx","dy","dispatchAction","extend","animation","duration","updateViewOnZoom","scale","originX","originY","setPointerChecker","containPoint","onIrrelevantElement","resetForLabelLayout","label","getTextContent","ignore","mapDraw","dataIndex","normalStyleModel","emphasisStyleModel","blurStyleModel","selectStyleModel","normalStyle","emphasisStyle","selectStyle","getItemVisual","decal","createOrUpdatePatternFromDecal","setStyle","strokeNoScale","labelXY","isDataNaN","isNaN","mapDimension","itemLayout","getItemLayout","showLabel","query","labelFetcher","specifiedTextOpt","normal","align","verticalAlign","setLabelStyle","getLabelStatesModels","labelDataIndex","defaultText","textEl","textConfig","rect","getBoundingRect","clone","layoutRect","position","width","height","disableLabelAnimation","removeTextContent","removeTextConfig","eventTrigger","setItemGraphicEl","getECData","eventData","componentIndex","geoIndex","option","setTooltipConfig","componentModel","itemName","itemTooltipOption","highDownSilentOnTouch","emphasisModel","focus","toggleHoverEmphasis","enableComponentHighDownFeatures","rings","createStream","polygons","curPoly","startPolygon","endPolygon","polygonStart","polygonEnd","lineStart","lineEnd","isFinite","sphere","ring"],"sources":["C:/Users/Z/Desktop/efficient/node_modules/echarts/lib/component/helper/MapDraw.js"],"sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util.js';\nimport RoamController from './RoamController.js';\nimport * as roamHelper from '../../component/helper/roamHelper.js';\nimport { onIrrelevantElement } from '../../component/helper/cursorHelper.js';\nimport * as graphic from '../../util/graphic.js';\nimport { toggleHoverEmphasis, enableComponentHighDownFeatures, setDefaultStateProxy } from '../../util/states.js';\nimport geoSourceManager from '../../coord/geo/geoSourceManager.js';\nimport { getUID } from '../../util/component.js';\nimport { setLabelStyle, getLabelStatesModels } from '../../label/labelStyle.js';\nimport { getECData } from '../../util/innerStore.js';\nimport { createOrUpdatePatternFromDecal } from '../../util/decal.js';\nimport Displayable from 'zrender/lib/graphic/Displayable.js';\nimport { makeInner } from '../../util/model.js';\n/**\n * Only these tags enable use `itemStyle` if they are named in SVG.\n * Other tags like <text> <tspan> <image> might not suitable for `itemStyle`.\n * They will not be considered to be styled until some requirements come.\n */\n\nvar OPTION_STYLE_ENABLED_TAGS = ['rect', 'circle', 'line', 'ellipse', 'polygon', 'polyline', 'path'];\nvar OPTION_STYLE_ENABLED_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS);\nvar STATE_TRIGGER_TAG_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar LABEL_HOST_MAP = zrUtil.createHashMap(OPTION_STYLE_ENABLED_TAGS.concat(['g']));\nvar mapLabelRaw = makeInner();\n\nfunction getFixedItemStyle(model) {\n  var itemStyle = model.getItemStyle();\n  var areaColor = model.get('areaColor'); // If user want the color not to be changed when hover,\n  // they should both set areaColor and color to be null.\n\n  if (areaColor != null) {\n    itemStyle.fill = areaColor;\n  }\n\n  return itemStyle;\n} // Only stroke can be used for line.\n// Using fill in style if stroke not exits.\n// TODO Not sure yet. Perhaps a separate `lineStyle`?\n\n\nfunction fixLineStyle(styleHost) {\n  var style = styleHost.style;\n\n  if (style) {\n    style.stroke = style.stroke || style.fill;\n    style.fill = null;\n  }\n}\n\nvar MapDraw =\n/** @class */\nfunction () {\n  function MapDraw(api) {\n    var group = new graphic.Group();\n    this.uid = getUID('ec_map_draw');\n    this._controller = new RoamController(api.getZr());\n    this._controllerHost = {\n      target: group\n    };\n    this.group = group;\n    group.add(this._regionsGroup = new graphic.Group());\n    group.add(this._svgGroup = new graphic.Group());\n  }\n\n  MapDraw.prototype.draw = function (mapOrGeoModel, ecModel, api, fromView, payload) {\n    var isGeo = mapOrGeoModel.mainType === 'geo'; // Map series has data. GEO model that controlled by map series\n    // will be assigned with map data. Other GEO model has no data.\n\n    var data = mapOrGeoModel.getData && mapOrGeoModel.getData();\n    isGeo && ecModel.eachComponent({\n      mainType: 'series',\n      subType: 'map'\n    }, function (mapSeries) {\n      if (!data && mapSeries.getHostGeoModel() === mapOrGeoModel) {\n        data = mapSeries.getData();\n      }\n    });\n    var geo = mapOrGeoModel.coordinateSystem;\n    var regionsGroup = this._regionsGroup;\n    var group = this.group;\n    var transformInfo = geo.getTransformInfo();\n    var transformInfoRaw = transformInfo.raw;\n    var transformInfoRoam = transformInfo.roam; // No animation when first draw or in action\n\n    var isFirstDraw = !regionsGroup.childAt(0) || payload;\n\n    if (isFirstDraw) {\n      group.x = transformInfoRoam.x;\n      group.y = transformInfoRoam.y;\n      group.scaleX = transformInfoRoam.scaleX;\n      group.scaleY = transformInfoRoam.scaleY;\n      group.dirty();\n    } else {\n      graphic.updateProps(group, transformInfoRoam, mapOrGeoModel);\n    }\n\n    var isVisualEncodedByVisualMap = data && data.getVisual('visualMeta') && data.getVisual('visualMeta').length > 0;\n    var viewBuildCtx = {\n      api: api,\n      geo: geo,\n      mapOrGeoModel: mapOrGeoModel,\n      data: data,\n      isVisualEncodedByVisualMap: isVisualEncodedByVisualMap,\n      isGeo: isGeo,\n      transformInfoRaw: transformInfoRaw\n    };\n\n    if (geo.resourceType === 'geoJSON') {\n      this._buildGeoJSON(viewBuildCtx);\n    } else if (geo.resourceType === 'geoSVG') {\n      this._buildSVG(viewBuildCtx);\n    }\n\n    this._updateController(mapOrGeoModel, ecModel, api);\n\n    this._updateMapSelectHandler(mapOrGeoModel, regionsGroup, api, fromView);\n  };\n\n  MapDraw.prototype._buildGeoJSON = function (viewBuildCtx) {\n    var regionsGroupByName = this._regionsGroupByName = zrUtil.createHashMap();\n    var regionsInfoByName = zrUtil.createHashMap();\n    var regionsGroup = this._regionsGroup;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n    var data = viewBuildCtx.data;\n    var projection = viewBuildCtx.geo.projection;\n    var projectionStream = projection && projection.stream;\n\n    function transformPoint(point, project) {\n      if (project) {\n        // projection may return null point.\n        point = project(point);\n      }\n\n      return point && [point[0] * transformInfoRaw.scaleX + transformInfoRaw.x, point[1] * transformInfoRaw.scaleY + transformInfoRaw.y];\n    }\n\n    ;\n\n    function transformPolygonPoints(inPoints) {\n      var outPoints = []; // If projectionStream is provided. Use it instead of single point project.\n\n      var project = !projectionStream && projection && projection.project;\n\n      for (var i = 0; i < inPoints.length; ++i) {\n        var newPt = transformPoint(inPoints[i], project);\n        newPt && outPoints.push(newPt);\n      }\n\n      return outPoints;\n    }\n\n    function getPolyShape(points) {\n      return {\n        shape: {\n          points: transformPolygonPoints(points)\n        }\n      };\n    }\n\n    regionsGroup.removeAll(); // Only when the resource is GeoJSON, there is `geo.regions`.\n\n    zrUtil.each(viewBuildCtx.geo.regions, function (region) {\n      var regionName = region.name; // Consider in GeoJson properties.name may be duplicated, for example,\n      // there is multiple region named \"United Kindom\" or \"France\" (so many\n      // colonies). And it is not appropriate to merge them in geo, which\n      // will make them share the same label and bring trouble in label\n      // location calculation.\n\n      var regionGroup = regionsGroupByName.get(regionName);\n\n      var _a = regionsInfoByName.get(regionName) || {},\n          dataIdx = _a.dataIdx,\n          regionModel = _a.regionModel;\n\n      if (!regionGroup) {\n        regionGroup = regionsGroupByName.set(regionName, new graphic.Group());\n        regionsGroup.add(regionGroup);\n        dataIdx = data ? data.indexOfName(regionName) : null;\n        regionModel = viewBuildCtx.isGeo ? mapOrGeoModel.getRegionModel(regionName) : data ? data.getItemModel(dataIdx) : null;\n        regionsInfoByName.set(regionName, {\n          dataIdx: dataIdx,\n          regionModel: regionModel\n        });\n      }\n\n      var polygonSubpaths = [];\n      var polylineSubpaths = [];\n      zrUtil.each(region.geometries, function (geometry) {\n        // Polygon and MultiPolygon\n        if (geometry.type === 'polygon') {\n          var polys = [geometry.exterior].concat(geometry.interiors || []);\n\n          if (projectionStream) {\n            polys = projectPolys(polys, projectionStream);\n          }\n\n          zrUtil.each(polys, function (poly) {\n            polygonSubpaths.push(new graphic.Polygon(getPolyShape(poly)));\n          });\n        } // LineString and MultiLineString\n        else {\n            var points = geometry.points;\n\n            if (projectionStream) {\n              points = projectPolys(points, projectionStream, true);\n            }\n\n            zrUtil.each(points, function (points) {\n              polylineSubpaths.push(new graphic.Polyline(getPolyShape(points)));\n            });\n          }\n      });\n      var centerPt = transformPoint(region.getCenter(), projection && projection.project);\n\n      function createCompoundPath(subpaths, isLine) {\n        if (!subpaths.length) {\n          return;\n        }\n\n        var compoundPath = new graphic.CompoundPath({\n          culling: true,\n          segmentIgnoreThreshold: 1,\n          shape: {\n            paths: subpaths\n          }\n        });\n        regionGroup.add(compoundPath);\n        applyOptionStyleForRegion(viewBuildCtx, compoundPath, dataIdx, regionModel);\n        resetLabelForRegion(viewBuildCtx, compoundPath, regionName, regionModel, mapOrGeoModel, dataIdx, centerPt);\n\n        if (isLine) {\n          fixLineStyle(compoundPath);\n          zrUtil.each(compoundPath.states, fixLineStyle);\n        }\n      }\n\n      createCompoundPath(polygonSubpaths);\n      createCompoundPath(polylineSubpaths, true);\n    }); // Ensure children have been added to `regionGroup` before calling them.\n\n    regionsGroupByName.each(function (regionGroup, regionName) {\n      var _a = regionsInfoByName.get(regionName),\n          dataIdx = _a.dataIdx,\n          regionModel = _a.regionModel;\n\n      resetEventTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel, dataIdx);\n      resetTooltipForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n      resetStateTriggerForRegion(viewBuildCtx, regionGroup, regionName, regionModel, mapOrGeoModel);\n    }, this);\n  };\n\n  MapDraw.prototype._buildSVG = function (viewBuildCtx) {\n    var mapName = viewBuildCtx.geo.map;\n    var transformInfoRaw = viewBuildCtx.transformInfoRaw;\n    this._svgGroup.x = transformInfoRaw.x;\n    this._svgGroup.y = transformInfoRaw.y;\n    this._svgGroup.scaleX = transformInfoRaw.scaleX;\n    this._svgGroup.scaleY = transformInfoRaw.scaleY;\n\n    if (this._svgResourceChanged(mapName)) {\n      this._freeSVG();\n\n      this._useSVG(mapName);\n    }\n\n    var svgDispatcherMap = this._svgDispatcherMap = zrUtil.createHashMap();\n    var focusSelf = false;\n    zrUtil.each(this._svgGraphicRecord.named, function (namedItem) {\n      // Note that we also allow different elements have the same name.\n      // For example, a glyph of a city and the label of the city have\n      // the same name and their tooltip info can be defined in a single\n      // region option.\n      var regionName = namedItem.name;\n      var mapOrGeoModel = viewBuildCtx.mapOrGeoModel;\n      var data = viewBuildCtx.data;\n      var svgNodeTagLower = namedItem.svgNodeTagLower;\n      var el = namedItem.el;\n      var dataIdx = data ? data.indexOfName(regionName) : null;\n      var regionModel = mapOrGeoModel.getRegionModel(regionName);\n\n      if (OPTION_STYLE_ENABLED_TAG_MAP.get(svgNodeTagLower) != null && el instanceof Displayable) {\n        applyOptionStyleForRegion(viewBuildCtx, el, dataIdx, regionModel);\n      }\n\n      if (el instanceof Displayable) {\n        el.culling = true;\n      } // We do not know how the SVG like so we'd better not to change z2.\n      // Otherwise it might bring some unexpected result. For example,\n      // an area hovered that make some inner city can not be clicked.\n\n\n      el.z2EmphasisLift = 0; // If self named:\n\n      if (!namedItem.namedFrom) {\n        // label should batter to be displayed based on the center of <g>\n        // if it is named rather than displayed on each child.\n        if (LABEL_HOST_MAP.get(svgNodeTagLower) != null) {\n          resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx, null);\n        }\n\n        resetEventTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, dataIdx);\n        resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n        if (STATE_TRIGGER_TAG_MAP.get(svgNodeTagLower) != null) {\n          var focus_1 = resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel);\n\n          if (focus_1 === 'self') {\n            focusSelf = true;\n          }\n\n          var els = svgDispatcherMap.get(regionName) || svgDispatcherMap.set(regionName, []);\n          els.push(el);\n        }\n      }\n    }, this);\n\n    this._enableBlurEntireSVG(focusSelf, viewBuildCtx);\n  };\n\n  MapDraw.prototype._enableBlurEntireSVG = function (focusSelf, viewBuildCtx) {\n    // It's a little complicated to support blurring the entire geoSVG in series-map.\n    // So do not suport it until some requirements come.\n    // At present, in series-map, only regions can be blurred.\n    if (focusSelf && viewBuildCtx.isGeo) {\n      var blurStyle = viewBuildCtx.mapOrGeoModel.getModel(['blur', 'itemStyle']).getItemStyle(); // Only suport `opacity` here. Because not sure that other props are suitable for\n      // all of the elements generated by SVG (especially for Text/TSpan/Image/... ).\n\n      var opacity_1 = blurStyle.opacity;\n\n      this._svgGraphicRecord.root.traverse(function (el) {\n        if (!el.isGroup) {\n          // PENDING: clear those settings to SVG elements when `_freeSVG`.\n          // (Currently it happen not to be needed.)\n          setDefaultStateProxy(el);\n          var style = el.ensureState('blur').style || {}; // Do not overwrite the region style that already set from region option.\n\n          if (style.opacity == null && opacity_1 != null) {\n            style.opacity = opacity_1;\n          } // If `ensureState('blur').style = {}`, there will be default opacity.\n          // Enable `stateTransition` (animation).\n\n\n          el.ensureState('emphasis');\n        }\n      });\n    }\n  };\n\n  MapDraw.prototype.remove = function () {\n    this._regionsGroup.removeAll();\n\n    this._regionsGroupByName = null;\n\n    this._svgGroup.removeAll();\n\n    this._freeSVG();\n\n    this._controller.dispose();\n\n    this._controllerHost = null;\n  };\n\n  MapDraw.prototype.findHighDownDispatchers = function (name, geoModel) {\n    if (name == null) {\n      return [];\n    }\n\n    var geo = geoModel.coordinateSystem;\n\n    if (geo.resourceType === 'geoJSON') {\n      var regionsGroupByName = this._regionsGroupByName;\n\n      if (regionsGroupByName) {\n        var regionGroup = regionsGroupByName.get(name);\n        return regionGroup ? [regionGroup] : [];\n      }\n    } else if (geo.resourceType === 'geoSVG') {\n      return this._svgDispatcherMap && this._svgDispatcherMap.get(name) || [];\n    }\n  };\n\n  MapDraw.prototype._svgResourceChanged = function (mapName) {\n    return this._svgMapName !== mapName;\n  };\n\n  MapDraw.prototype._useSVG = function (mapName) {\n    var resource = geoSourceManager.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      var svgGraphic = resource.useGraphic(this.uid);\n\n      this._svgGroup.add(svgGraphic.root);\n\n      this._svgGraphicRecord = svgGraphic;\n      this._svgMapName = mapName;\n    }\n  };\n\n  MapDraw.prototype._freeSVG = function () {\n    var mapName = this._svgMapName;\n\n    if (mapName == null) {\n      return;\n    }\n\n    var resource = geoSourceManager.getGeoResource(mapName);\n\n    if (resource && resource.type === 'geoSVG') {\n      resource.freeGraphic(this.uid);\n    }\n\n    this._svgGraphicRecord = null;\n    this._svgDispatcherMap = null;\n\n    this._svgGroup.removeAll();\n\n    this._svgMapName = null;\n  };\n\n  MapDraw.prototype._updateController = function (mapOrGeoModel, ecModel, api) {\n    var geo = mapOrGeoModel.coordinateSystem;\n    var controller = this._controller;\n    var controllerHost = this._controllerHost; // @ts-ignore FIXME:TS\n\n    controllerHost.zoomLimit = mapOrGeoModel.get('scaleLimit');\n    controllerHost.zoom = geo.getZoom(); // roamType is will be set default true if it is null\n    // @ts-ignore FIXME:TS\n\n    controller.enable(mapOrGeoModel.get('roam') || false);\n    var mainType = mapOrGeoModel.mainType;\n\n    function makeActionBase() {\n      var action = {\n        type: 'geoRoam',\n        componentType: mainType\n      };\n      action[mainType + 'Id'] = mapOrGeoModel.id;\n      return action;\n    }\n\n    controller.off('pan').on('pan', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnPan(controllerHost, e.dx, e.dy);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        dx: e.dx,\n        dy: e.dy,\n        animation: {\n          duration: 0\n        }\n      }));\n    }, this);\n    controller.off('zoom').on('zoom', function (e) {\n      this._mouseDownFlag = false;\n      roamHelper.updateViewOnZoom(controllerHost, e.scale, e.originX, e.originY);\n      api.dispatchAction(zrUtil.extend(makeActionBase(), {\n        zoom: e.scale,\n        originX: e.originX,\n        originY: e.originY,\n        animation: {\n          duration: 0\n        }\n      }));\n    }, this);\n    controller.setPointerChecker(function (e, x, y) {\n      return geo.containPoint([x, y]) && !onIrrelevantElement(e, api, mapOrGeoModel);\n    });\n  };\n  /**\n   * FIXME: this is a temporarily workaround.\n   * When `geoRoam` the elements need to be reset in `MapView['render']`, because the props like\n   * `ignore` might have been modified by `LabelManager`, and `LabelManager#addLabelsOfSeries`\n   * will subsequently cache `defaultAttr` like `ignore`. If do not do this reset, the modified\n   * props will have no chance to be restored.\n   * Note: this reset should be after `clearStates` in `renderSeries` becuase `useStates` in\n   * `renderSeries` will cache the modified `ignore` to `el._normalState`.\n   * TODO:\n   * Use clone/immutable in `LabelManager`?\n   */\n\n\n  MapDraw.prototype.resetForLabelLayout = function () {\n    this.group.traverse(function (el) {\n      var label = el.getTextContent();\n\n      if (label) {\n        label.ignore = mapLabelRaw(label).ignore;\n      }\n    });\n  };\n\n  MapDraw.prototype._updateMapSelectHandler = function (mapOrGeoModel, regionsGroup, api, fromView) {\n    var mapDraw = this;\n    regionsGroup.off('mousedown');\n    regionsGroup.off('click'); // @ts-ignore FIXME:TS resolve type conflict\n\n    if (mapOrGeoModel.get('selectedMode')) {\n      regionsGroup.on('mousedown', function () {\n        mapDraw._mouseDownFlag = true;\n      });\n      regionsGroup.on('click', function (e) {\n        if (!mapDraw._mouseDownFlag) {\n          return;\n        }\n\n        mapDraw._mouseDownFlag = false;\n      });\n    }\n  };\n\n  return MapDraw;\n}();\n\n;\n\nfunction applyOptionStyleForRegion(viewBuildCtx, el, dataIndex, regionModel) {\n  // All of the path are using `itemStyle`, becuase\n  // (1) Some SVG also use fill on polyline (The different between\n  // polyline and polygon is \"open\" or \"close\" but not fill or not).\n  // (2) For the common props like opacity, if some use itemStyle\n  // and some use `lineStyle`, it might confuse users.\n  // (3) Most SVG use <path>, where can not detect wether draw a \"line\"\n  // or a filled shape, so use `itemStyle` for <path>.\n  var normalStyleModel = regionModel.getModel('itemStyle');\n  var emphasisStyleModel = regionModel.getModel(['emphasis', 'itemStyle']);\n  var blurStyleModel = regionModel.getModel(['blur', 'itemStyle']);\n  var selectStyleModel = regionModel.getModel(['select', 'itemStyle']); // NOTE: DONT use 'style' in visual when drawing map.\n  // This component is used for drawing underlying map for both geo component and map series.\n\n  var normalStyle = getFixedItemStyle(normalStyleModel);\n  var emphasisStyle = getFixedItemStyle(emphasisStyleModel);\n  var selectStyle = getFixedItemStyle(selectStyleModel);\n  var blurStyle = getFixedItemStyle(blurStyleModel); // Update the itemStyle if has data visual\n\n  var data = viewBuildCtx.data;\n\n  if (data) {\n    // Only visual color of each item will be used. It can be encoded by visualMap\n    // But visual color of series is used in symbol drawing\n    // Visual color for each series is for the symbol draw\n    var style = data.getItemVisual(dataIndex, 'style');\n    var decal = data.getItemVisual(dataIndex, 'decal');\n\n    if (viewBuildCtx.isVisualEncodedByVisualMap && style.fill) {\n      normalStyle.fill = style.fill;\n    }\n\n    if (decal) {\n      normalStyle.decal = createOrUpdatePatternFromDecal(decal, viewBuildCtx.api);\n    }\n  } // SVG text, tspan and image can be named but not supporeted\n  // to be styled by region option yet.\n\n\n  el.setStyle(normalStyle);\n  el.style.strokeNoScale = true;\n  el.ensureState('emphasis').style = emphasisStyle;\n  el.ensureState('select').style = selectStyle;\n  el.ensureState('blur').style = blurStyle; // Enable blur\n\n  setDefaultStateProxy(el);\n}\n\nfunction resetLabelForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx, // If labelXY not provided, use `textConfig.position: 'inside'`\nlabelXY) {\n  var data = viewBuildCtx.data;\n  var isGeo = viewBuildCtx.isGeo;\n  var isDataNaN = data && isNaN(data.get(data.mapDimension('value'), dataIdx));\n  var itemLayout = data && data.getItemLayout(dataIdx); // In the following cases label will be drawn\n  // 1. In map series and data value is NaN\n  // 2. In geo component\n  // 3. Region has no series legendIcon, which will be add a showLabel flag in mapSymbolLayout\n\n  if (isGeo || isDataNaN || itemLayout && itemLayout.showLabel) {\n    var query = !isGeo ? dataIdx : regionName;\n    var labelFetcher = void 0; // Consider dataIdx not found.\n\n    if (!data || dataIdx >= 0) {\n      labelFetcher = mapOrGeoModel;\n    }\n\n    var specifiedTextOpt = labelXY ? {\n      normal: {\n        align: 'center',\n        verticalAlign: 'middle'\n      }\n    } : null; // Caveat: must be called after `setDefaultStateProxy(el);` called.\n    // because textContent will be assign with `el.stateProxy` inside.\n\n    setLabelStyle(el, getLabelStatesModels(regionModel), {\n      labelFetcher: labelFetcher,\n      labelDataIndex: query,\n      defaultText: regionName\n    }, specifiedTextOpt);\n    var textEl = el.getTextContent();\n\n    if (textEl) {\n      mapLabelRaw(textEl).ignore = textEl.ignore;\n\n      if (el.textConfig && labelXY) {\n        // Compute a relative offset based on the el bounding rect.\n        var rect = el.getBoundingRect().clone(); // Need to make sure the percent position base on the same rect in normal and\n        // emphasis state. Otherwise if using boundingRect of el, but the emphasis state\n        // has borderWidth (even 0.5px), the text position will be changed obviously\n        // if the position is very big like ['1234%', '1345%'].\n\n        el.textConfig.layoutRect = rect;\n        el.textConfig.position = [(labelXY[0] - rect.x) / rect.width * 100 + '%', (labelXY[1] - rect.y) / rect.height * 100 + '%'];\n      }\n    } // PENDING:\n    // If labelLayout is enabled (test/label-layout.html), el.dataIndex should be specified.\n    // But el.dataIndex is also used to determine whether user event should be triggered,\n    // where el.seriesIndex or el.dataModel must be specified. At present for a single el\n    // there is not case that \"only label layout enabled but user event disabled\", so here\n    // we depends `resetEventTriggerForRegion` to do the job of setting `el.dataIndex`.\n\n\n    el.disableLabelAnimation = true;\n  } else {\n    el.removeTextContent();\n    el.removeTextConfig();\n    el.disableLabelAnimation = null;\n  }\n}\n\nfunction resetEventTriggerForRegion(viewBuildCtx, eventTrigger, regionName, regionModel, mapOrGeoModel, // Exist only if `viewBuildCtx.data` exists.\ndataIdx) {\n  // setItemGraphicEl, setHoverStyle after all polygons and labels\n  // are added to the rigionGroup\n  if (viewBuildCtx.data) {\n    // FIXME: when series-map use a SVG map, and there are duplicated name specified\n    // on different SVG elements, after `data.setItemGraphicEl(...)`:\n    // (1) all of them will be mounted with `dataIndex`, `seriesIndex`, so that tooltip\n    // can be triggered only mouse hover. That's correct.\n    // (2) only the last element will be kept in `data`, so that if trigger tooltip\n    // by `dispatchAction`, only the last one can be found and triggered. That might be\n    // not correct. We will fix it in future if anyone demanding that.\n    viewBuildCtx.data.setItemGraphicEl(dataIdx, eventTrigger);\n  } // series-map will not trigger \"geoselectchange\" no matter it is\n  // based on a declared geo component. Becuause series-map will\n  // trigger \"selectchange\". If it trigger both the two events,\n  // If users call `chart.dispatchAction({type: 'toggleSelect'})`,\n  // it not easy to also fire event \"geoselectchanged\".\n  else {\n      // Package custom mouse event for geo component\n      getECData(eventTrigger).eventData = {\n        componentType: 'geo',\n        componentIndex: mapOrGeoModel.componentIndex,\n        geoIndex: mapOrGeoModel.componentIndex,\n        name: regionName,\n        region: regionModel && regionModel.option || {}\n      };\n    }\n}\n\nfunction resetTooltipForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  if (!viewBuildCtx.data) {\n    graphic.setTooltipConfig({\n      el: el,\n      componentModel: mapOrGeoModel,\n      itemName: regionName,\n      // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n      itemTooltipOption: regionModel.get('tooltip')\n    });\n  }\n}\n\nfunction resetStateTriggerForRegion(viewBuildCtx, el, regionName, regionModel, mapOrGeoModel) {\n  // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n  el.highDownSilentOnTouch = !!mapOrGeoModel.get('selectedMode'); // @ts-ignore FIXME:TS fix the \"compatible with each other\"?\n\n  var emphasisModel = regionModel.getModel('emphasis');\n  var focus = emphasisModel.get('focus');\n  toggleHoverEmphasis(el, focus, emphasisModel.get('blurScope'), emphasisModel.get('disabled'));\n\n  if (viewBuildCtx.isGeo) {\n    enableComponentHighDownFeatures(el, mapOrGeoModel, regionName);\n  }\n\n  return focus;\n}\n\nfunction projectPolys(rings, // Polygons include exterior and interiors. Or polylines.\ncreateStream, isLine) {\n  var polygons = [];\n  var curPoly;\n\n  function startPolygon() {\n    curPoly = [];\n  }\n\n  function endPolygon() {\n    if (curPoly.length) {\n      polygons.push(curPoly);\n      curPoly = [];\n    }\n  }\n\n  var stream = createStream({\n    polygonStart: startPolygon,\n    polygonEnd: endPolygon,\n    lineStart: startPolygon,\n    lineEnd: endPolygon,\n    point: function (x, y) {\n      // May have NaN values from stream.\n      if (isFinite(x) && isFinite(y)) {\n        curPoly.push([x, y]);\n      }\n    },\n    sphere: function () {}\n  });\n  !isLine && stream.polygonStart();\n  zrUtil.each(rings, function (ring) {\n    stream.lineStart();\n\n    for (var i = 0; i < ring.length; i++) {\n      stream.point(ring[i][0], ring[i][1]);\n    }\n\n    stream.lineEnd();\n  });\n  !isLine && stream.polygonEnd();\n  return polygons;\n}\n\nexport default MapDraw; // @ts-ignore FIXME:TS fix the \"compatible with each other\"?"],"mappings":";;;;;;;;;;;AA2CA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAcA;AACA;AACA;AACA;AACA;AAEA,IAAIA,yBAAyB,GAAG,CAAC,MAAD,EAAS,QAAT,EAAmB,MAAnB,EAA2B,SAA3B,EAAsC,SAAtC,EAAiD,UAAjD,EAA6D,MAA7D,CAAhC;AACA,IAAIC,4BAA4B,GAAGC,MAAM,CAACC,aAAP,CAAqBH,yBAArB,CAAnC;AACA,IAAII,qBAAqB,GAAGF,MAAM,CAACC,aAAP,CAAqBH,yBAAyB,CAACK,MAA1B,CAAiC,CAAC,GAAD,CAAjC,CAArB,CAA5B;AACA,IAAIC,cAAc,GAAGJ,MAAM,CAACC,aAAP,CAAqBH,yBAAyB,CAACK,MAA1B,CAAiC,CAAC,GAAD,CAAjC,CAArB,CAArB;AACA,IAAIE,WAAW,GAAG,IAAAC,gBAAA,GAAlB;;AAEA,SAASC,iBAAT,CAA2BC,KAA3B,EAAkC;EAChC,IAAIC,SAAS,GAAGD,KAAK,CAACE,YAAN,EAAhB;EACA,IAAIC,SAAS,GAAGH,KAAK,CAACI,GAAN,CAAU,WAAV,CAAhB,CAFgC,CAEQ;EACxC;;EAEA,IAAID,SAAS,IAAI,IAAjB,EAAuB;IACrBF,SAAS,CAACI,IAAV,GAAiBF,SAAjB;EACD;;EAED,OAAOF,SAAP;AACD,C,CAAC;AACF;AACA;;;AAGA,SAASK,YAAT,CAAsBC,SAAtB,EAAiC;EAC/B,IAAIC,KAAK,GAAGD,SAAS,CAACC,KAAtB;;EAEA,IAAIA,KAAJ,EAAW;IACTA,KAAK,CAACC,MAAN,GAAeD,KAAK,CAACC,MAAN,IAAgBD,KAAK,CAACH,IAArC;IACAG,KAAK,CAACH,IAAN,GAAa,IAAb;EACD;AACF;;AAED,IAAIK,OAAO;AACX;AACA,YAAY;EACV,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;IACpB,IAAIC,KAAK,GAAG,IAAIC,OAAO,CAACC,KAAZ,EAAZ;IACA,KAAKC,GAAL,GAAW,IAAAC,iBAAA,EAAO,aAAP,CAAX;IACA,KAAKC,WAAL,GAAmB,IAAIC,uBAAJ,CAAmBP,GAAG,CAACQ,KAAJ,EAAnB,CAAnB;IACA,KAAKC,eAAL,GAAuB;MACrBC,MAAM,EAAET;IADa,CAAvB;IAGA,KAAKA,KAAL,GAAaA,KAAb;IACAA,KAAK,CAACU,GAAN,CAAU,KAAKC,aAAL,GAAqB,IAAIV,OAAO,CAACC,KAAZ,EAA/B;IACAF,KAAK,CAACU,GAAN,CAAU,KAAKE,SAAL,GAAiB,IAAIX,OAAO,CAACC,KAAZ,EAA3B;EACD;;EAEDJ,OAAO,CAACe,SAAR,CAAkBC,IAAlB,GAAyB,UAAUC,aAAV,EAAyBC,OAAzB,EAAkCjB,GAAlC,EAAuCkB,QAAvC,EAAiDC,OAAjD,EAA0D;IACjF,IAAIC,KAAK,GAAGJ,aAAa,CAACK,QAAd,KAA2B,KAAvC,CADiF,CACnC;IAC9C;;IAEA,IAAIC,IAAI,GAAGN,aAAa,CAACO,OAAd,IAAyBP,aAAa,CAACO,OAAd,EAApC;IACAH,KAAK,IAAIH,OAAO,CAACO,aAAR,CAAsB;MAC7BH,QAAQ,EAAE,QADmB;MAE7BI,OAAO,EAAE;IAFoB,CAAtB,EAGN,UAAUC,SAAV,EAAqB;MACtB,IAAI,CAACJ,IAAD,IAASI,SAAS,CAACC,eAAV,OAAgCX,aAA7C,EAA4D;QAC1DM,IAAI,GAAGI,SAAS,CAACH,OAAV,EAAP;MACD;IACF,CAPQ,CAAT;IAQA,IAAIK,GAAG,GAAGZ,aAAa,CAACa,gBAAxB;IACA,IAAIC,YAAY,GAAG,KAAKlB,aAAxB;IACA,IAAIX,KAAK,GAAG,KAAKA,KAAjB;IACA,IAAI8B,aAAa,GAAGH,GAAG,CAACI,gBAAJ,EAApB;IACA,IAAIC,gBAAgB,GAAGF,aAAa,CAACG,GAArC;IACA,IAAIC,iBAAiB,GAAGJ,aAAa,CAACK,IAAtC,CAlBiF,CAkBrC;;IAE5C,IAAIC,WAAW,GAAG,CAACP,YAAY,CAACQ,OAAb,CAAqB,CAArB,CAAD,IAA4BnB,OAA9C;;IAEA,IAAIkB,WAAJ,EAAiB;MACfpC,KAAK,CAACsC,CAAN,GAAUJ,iBAAiB,CAACI,CAA5B;MACAtC,KAAK,CAACuC,CAAN,GAAUL,iBAAiB,CAACK,CAA5B;MACAvC,KAAK,CAACwC,MAAN,GAAeN,iBAAiB,CAACM,MAAjC;MACAxC,KAAK,CAACyC,MAAN,GAAeP,iBAAiB,CAACO,MAAjC;MACAzC,KAAK,CAAC0C,KAAN;IACD,CAND,MAMO;MACLzC,OAAO,CAAC0C,WAAR,CAAoB3C,KAApB,EAA2BkC,iBAA3B,EAA8CnB,aAA9C;IACD;;IAED,IAAI6B,0BAA0B,GAAGvB,IAAI,IAAIA,IAAI,CAACwB,SAAL,CAAe,YAAf,CAAR,IAAwCxB,IAAI,CAACwB,SAAL,CAAe,YAAf,EAA6BC,MAA7B,GAAsC,CAA/G;IACA,IAAIC,YAAY,GAAG;MACjBhD,GAAG,EAAEA,GADY;MAEjB4B,GAAG,EAAEA,GAFY;MAGjBZ,aAAa,EAAEA,aAHE;MAIjBM,IAAI,EAAEA,IAJW;MAKjBuB,0BAA0B,EAAEA,0BALX;MAMjBzB,KAAK,EAAEA,KANU;MAOjBa,gBAAgB,EAAEA;IAPD,CAAnB;;IAUA,IAAIL,GAAG,CAACqB,YAAJ,KAAqB,SAAzB,EAAoC;MAClC,KAAKC,aAAL,CAAmBF,YAAnB;IACD,CAFD,MAEO,IAAIpB,GAAG,CAACqB,YAAJ,KAAqB,QAAzB,EAAmC;MACxC,KAAKE,SAAL,CAAeH,YAAf;IACD;;IAED,KAAKI,iBAAL,CAAuBpC,aAAvB,EAAsCC,OAAtC,EAA+CjB,GAA/C;;IAEA,KAAKqD,uBAAL,CAA6BrC,aAA7B,EAA4Cc,YAA5C,EAA0D9B,GAA1D,EAA+DkB,QAA/D;EACD,CApDD;;EAsDAnB,OAAO,CAACe,SAAR,CAAkBoC,aAAlB,GAAkC,UAAUF,YAAV,EAAwB;IACxD,IAAIM,kBAAkB,GAAG,KAAKC,mBAAL,GAA2B1E,MAAM,CAACC,aAAP,EAApD;IACA,IAAI0E,iBAAiB,GAAG3E,MAAM,CAACC,aAAP,EAAxB;IACA,IAAIgD,YAAY,GAAG,KAAKlB,aAAxB;IACA,IAAIqB,gBAAgB,GAAGe,YAAY,CAACf,gBAApC;IACA,IAAIjB,aAAa,GAAGgC,YAAY,CAAChC,aAAjC;IACA,IAAIM,IAAI,GAAG0B,YAAY,CAAC1B,IAAxB;IACA,IAAImC,UAAU,GAAGT,YAAY,CAACpB,GAAb,CAAiB6B,UAAlC;IACA,IAAIC,gBAAgB,GAAGD,UAAU,IAAIA,UAAU,CAACE,MAAhD;;IAEA,SAASC,cAAT,CAAwBC,KAAxB,EAA+BC,OAA/B,EAAwC;MACtC,IAAIA,OAAJ,EAAa;QACX;QACAD,KAAK,GAAGC,OAAO,CAACD,KAAD,CAAf;MACD;;MAED,OAAOA,KAAK,IAAI,CAACA,KAAK,CAAC,CAAD,CAAL,GAAW5B,gBAAgB,CAACQ,MAA5B,GAAqCR,gBAAgB,CAACM,CAAvD,EAA0DsB,KAAK,CAAC,CAAD,CAAL,GAAW5B,gBAAgB,CAACS,MAA5B,GAAqCT,gBAAgB,CAACO,CAAhH,CAAhB;IACD;;IAED;;IAEA,SAASuB,sBAAT,CAAgCC,QAAhC,EAA0C;MACxC,IAAIC,SAAS,GAAG,EAAhB,CADwC,CACpB;;MAEpB,IAAIH,OAAO,GAAG,CAACJ,gBAAD,IAAqBD,UAArB,IAAmCA,UAAU,CAACK,OAA5D;;MAEA,KAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,QAAQ,CAACjB,MAA7B,EAAqC,EAAEmB,CAAvC,EAA0C;QACxC,IAAIC,KAAK,GAAGP,cAAc,CAACI,QAAQ,CAACE,CAAD,CAAT,EAAcJ,OAAd,CAA1B;QACAK,KAAK,IAAIF,SAAS,CAACG,IAAV,CAAeD,KAAf,CAAT;MACD;;MAED,OAAOF,SAAP;IACD;;IAED,SAASI,YAAT,CAAsBC,MAAtB,EAA8B;MAC5B,OAAO;QACLC,KAAK,EAAE;UACLD,MAAM,EAAEP,sBAAsB,CAACO,MAAD;QADzB;MADF,CAAP;IAKD;;IAEDxC,YAAY,CAAC0C,SAAb,GA1CwD,CA0C9B;;IAE1B3F,MAAM,CAAC4F,IAAP,CAAYzB,YAAY,CAACpB,GAAb,CAAiB8C,OAA7B,EAAsC,UAAUC,MAAV,EAAkB;MACtD,IAAIC,UAAU,GAAGD,MAAM,CAACE,IAAxB,CADsD,CACxB;MAC9B;MACA;MACA;MACA;;MAEA,IAAIC,WAAW,GAAGxB,kBAAkB,CAAC7D,GAAnB,CAAuBmF,UAAvB,CAAlB;;MAEA,IAAIG,EAAE,GAAGvB,iBAAiB,CAAC/D,GAAlB,CAAsBmF,UAAtB,KAAqC,EAA9C;MAAA,IACII,OAAO,GAAGD,EAAE,CAACC,OADjB;MAAA,IAEIC,WAAW,GAAGF,EAAE,CAACE,WAFrB;;MAIA,IAAI,CAACH,WAAL,EAAkB;QAChBA,WAAW,GAAGxB,kBAAkB,CAAC4B,GAAnB,CAAuBN,UAAvB,EAAmC,IAAI1E,OAAO,CAACC,KAAZ,EAAnC,CAAd;QACA2B,YAAY,CAACnB,GAAb,CAAiBmE,WAAjB;QACAE,OAAO,GAAG1D,IAAI,GAAGA,IAAI,CAAC6D,WAAL,CAAiBP,UAAjB,CAAH,GAAkC,IAAhD;QACAK,WAAW,GAAGjC,YAAY,CAAC5B,KAAb,GAAqBJ,aAAa,CAACoE,cAAd,CAA6BR,UAA7B,CAArB,GAAgEtD,IAAI,GAAGA,IAAI,CAAC+D,YAAL,CAAkBL,OAAlB,CAAH,GAAgC,IAAlH;QACAxB,iBAAiB,CAAC0B,GAAlB,CAAsBN,UAAtB,EAAkC;UAChCI,OAAO,EAAEA,OADuB;UAEhCC,WAAW,EAAEA;QAFmB,CAAlC;MAID;;MAED,IAAIK,eAAe,GAAG,EAAtB;MACA,IAAIC,gBAAgB,GAAG,EAAvB;MACA1G,MAAM,CAAC4F,IAAP,CAAYE,MAAM,CAACa,UAAnB,EAA+B,UAAUC,QAAV,EAAoB;QACjD;QACA,IAAIA,QAAQ,CAACC,IAAT,KAAkB,SAAtB,EAAiC;UAC/B,IAAIC,KAAK,GAAG,CAACF,QAAQ,CAACG,QAAV,EAAoB5G,MAApB,CAA2ByG,QAAQ,CAACI,SAAT,IAAsB,EAAjD,CAAZ;;UAEA,IAAInC,gBAAJ,EAAsB;YACpBiC,KAAK,GAAGG,YAAY,CAACH,KAAD,EAAQjC,gBAAR,CAApB;UACD;;UAED7E,MAAM,CAAC4F,IAAP,CAAYkB,KAAZ,EAAmB,UAAUI,IAAV,EAAgB;YACjCT,eAAe,CAAClB,IAAhB,CAAqB,IAAIlE,OAAO,CAAC8F,OAAZ,CAAoB3B,YAAY,CAAC0B,IAAD,CAAhC,CAArB;UACD,CAFD;QAGD,CAVD,CAUE;QAVF,KAWK;UACD,IAAIzB,MAAM,GAAGmB,QAAQ,CAACnB,MAAtB;;UAEA,IAAIZ,gBAAJ,EAAsB;YACpBY,MAAM,GAAGwB,YAAY,CAACxB,MAAD,EAASZ,gBAAT,EAA2B,IAA3B,CAArB;UACD;;UAED7E,MAAM,CAAC4F,IAAP,CAAYH,MAAZ,EAAoB,UAAUA,MAAV,EAAkB;YACpCiB,gBAAgB,CAACnB,IAAjB,CAAsB,IAAIlE,OAAO,CAAC+F,QAAZ,CAAqB5B,YAAY,CAACC,MAAD,CAAjC,CAAtB;UACD,CAFD;QAGD;MACJ,CAxBD;MAyBA,IAAI4B,QAAQ,GAAGtC,cAAc,CAACe,MAAM,CAACwB,SAAP,EAAD,EAAqB1C,UAAU,IAAIA,UAAU,CAACK,OAA9C,CAA7B;;MAEA,SAASsC,kBAAT,CAA4BC,QAA5B,EAAsCC,MAAtC,EAA8C;QAC5C,IAAI,CAACD,QAAQ,CAACtD,MAAd,EAAsB;UACpB;QACD;;QAED,IAAIwD,YAAY,GAAG,IAAIrG,OAAO,CAACsG,YAAZ,CAAyB;UAC1CC,OAAO,EAAE,IADiC;UAE1CC,sBAAsB,EAAE,CAFkB;UAG1CnC,KAAK,EAAE;YACLoC,KAAK,EAAEN;UADF;QAHmC,CAAzB,CAAnB;QAOAvB,WAAW,CAACnE,GAAZ,CAAgB4F,YAAhB;QACAK,yBAAyB,CAAC5D,YAAD,EAAeuD,YAAf,EAA6BvB,OAA7B,EAAsCC,WAAtC,CAAzB;QACA4B,mBAAmB,CAAC7D,YAAD,EAAeuD,YAAf,EAA6B3B,UAA7B,EAAyCK,WAAzC,EAAsDjE,aAAtD,EAAqEgE,OAArE,EAA8EkB,QAA9E,CAAnB;;QAEA,IAAII,MAAJ,EAAY;UACV3G,YAAY,CAAC4G,YAAD,CAAZ;UACA1H,MAAM,CAAC4F,IAAP,CAAY8B,YAAY,CAACO,MAAzB,EAAiCnH,YAAjC;QACD;MACF;;MAEDyG,kBAAkB,CAACd,eAAD,CAAlB;MACAc,kBAAkB,CAACb,gBAAD,EAAmB,IAAnB,CAAlB;IACD,CA7ED,EA5CwD,CAyHpD;;IAEJjC,kBAAkB,CAACmB,IAAnB,CAAwB,UAAUK,WAAV,EAAuBF,UAAvB,EAAmC;MACzD,IAAIG,EAAE,GAAGvB,iBAAiB,CAAC/D,GAAlB,CAAsBmF,UAAtB,CAAT;MAAA,IACII,OAAO,GAAGD,EAAE,CAACC,OADjB;MAAA,IAEIC,WAAW,GAAGF,EAAE,CAACE,WAFrB;;MAIA8B,0BAA0B,CAAC/D,YAAD,EAAe8B,WAAf,EAA4BF,UAA5B,EAAwCK,WAAxC,EAAqDjE,aAArD,EAAoEgE,OAApE,CAA1B;MACAgC,qBAAqB,CAAChE,YAAD,EAAe8B,WAAf,EAA4BF,UAA5B,EAAwCK,WAAxC,EAAqDjE,aAArD,CAArB;MACAiG,0BAA0B,CAACjE,YAAD,EAAe8B,WAAf,EAA4BF,UAA5B,EAAwCK,WAAxC,EAAqDjE,aAArD,CAA1B;IACD,CARD,EAQG,IARH;EASD,CApID;;EAsIAjB,OAAO,CAACe,SAAR,CAAkBqC,SAAlB,GAA8B,UAAUH,YAAV,EAAwB;IACpD,IAAIkE,OAAO,GAAGlE,YAAY,CAACpB,GAAb,CAAiBuF,GAA/B;IACA,IAAIlF,gBAAgB,GAAGe,YAAY,CAACf,gBAApC;IACA,KAAKpB,SAAL,CAAe0B,CAAf,GAAmBN,gBAAgB,CAACM,CAApC;IACA,KAAK1B,SAAL,CAAe2B,CAAf,GAAmBP,gBAAgB,CAACO,CAApC;IACA,KAAK3B,SAAL,CAAe4B,MAAf,GAAwBR,gBAAgB,CAACQ,MAAzC;IACA,KAAK5B,SAAL,CAAe6B,MAAf,GAAwBT,gBAAgB,CAACS,MAAzC;;IAEA,IAAI,KAAK0E,mBAAL,CAAyBF,OAAzB,CAAJ,EAAuC;MACrC,KAAKG,QAAL;;MAEA,KAAKC,OAAL,CAAaJ,OAAb;IACD;;IAED,IAAIK,gBAAgB,GAAG,KAAKC,iBAAL,GAAyB3I,MAAM,CAACC,aAAP,EAAhD;IACA,IAAI2I,SAAS,GAAG,KAAhB;IACA5I,MAAM,CAAC4F,IAAP,CAAY,KAAKiD,iBAAL,CAAuBC,KAAnC,EAA0C,UAAUC,SAAV,EAAqB;MAC7D;MACA;MACA;MACA;MACA,IAAIhD,UAAU,GAAGgD,SAAS,CAAC/C,IAA3B;MACA,IAAI7D,aAAa,GAAGgC,YAAY,CAAChC,aAAjC;MACA,IAAIM,IAAI,GAAG0B,YAAY,CAAC1B,IAAxB;MACA,IAAIuG,eAAe,GAAGD,SAAS,CAACC,eAAhC;MACA,IAAIC,EAAE,GAAGF,SAAS,CAACE,EAAnB;MACA,IAAI9C,OAAO,GAAG1D,IAAI,GAAGA,IAAI,CAAC6D,WAAL,CAAiBP,UAAjB,CAAH,GAAkC,IAApD;MACA,IAAIK,WAAW,GAAGjE,aAAa,CAACoE,cAAd,CAA6BR,UAA7B,CAAlB;;MAEA,IAAIhG,4BAA4B,CAACa,GAA7B,CAAiCoI,eAAjC,KAAqD,IAArD,IAA6DC,EAAE,YAAYC,oBAA/E,EAA4F;QAC1FnB,yBAAyB,CAAC5D,YAAD,EAAe8E,EAAf,EAAmB9C,OAAnB,EAA4BC,WAA5B,CAAzB;MACD;;MAED,IAAI6C,EAAE,YAAYC,oBAAlB,EAA+B;QAC7BD,EAAE,CAACrB,OAAH,GAAa,IAAb;MACD,CAnB4D,CAmB3D;MACF;MACA;;;MAGAqB,EAAE,CAACE,cAAH,GAAoB,CAApB,CAxB6D,CAwBtC;;MAEvB,IAAI,CAACJ,SAAS,CAACK,SAAf,EAA0B;QACxB;QACA;QACA,IAAIhJ,cAAc,CAACQ,GAAf,CAAmBoI,eAAnB,KAAuC,IAA3C,EAAiD;UAC/ChB,mBAAmB,CAAC7D,YAAD,EAAe8E,EAAf,EAAmBlD,UAAnB,EAA+BK,WAA/B,EAA4CjE,aAA5C,EAA2DgE,OAA3D,EAAoE,IAApE,CAAnB;QACD;;QAED+B,0BAA0B,CAAC/D,YAAD,EAAe8E,EAAf,EAAmBlD,UAAnB,EAA+BK,WAA/B,EAA4CjE,aAA5C,EAA2DgE,OAA3D,CAA1B;QACAgC,qBAAqB,CAAChE,YAAD,EAAe8E,EAAf,EAAmBlD,UAAnB,EAA+BK,WAA/B,EAA4CjE,aAA5C,CAArB;;QAEA,IAAIjC,qBAAqB,CAACU,GAAtB,CAA0BoI,eAA1B,KAA8C,IAAlD,EAAwD;UACtD,IAAIK,OAAO,GAAGjB,0BAA0B,CAACjE,YAAD,EAAe8E,EAAf,EAAmBlD,UAAnB,EAA+BK,WAA/B,EAA4CjE,aAA5C,CAAxC;;UAEA,IAAIkH,OAAO,KAAK,MAAhB,EAAwB;YACtBT,SAAS,GAAG,IAAZ;UACD;;UAED,IAAIU,GAAG,GAAGZ,gBAAgB,CAAC9H,GAAjB,CAAqBmF,UAArB,KAAoC2C,gBAAgB,CAACrC,GAAjB,CAAqBN,UAArB,EAAiC,EAAjC,CAA9C;UACAuD,GAAG,CAAC/D,IAAJ,CAAS0D,EAAT;QACD;MACF;IACF,CA/CD,EA+CG,IA/CH;;IAiDA,KAAKM,oBAAL,CAA0BX,SAA1B,EAAqCzE,YAArC;EACD,CAlED;;EAoEAjD,OAAO,CAACe,SAAR,CAAkBsH,oBAAlB,GAAyC,UAAUX,SAAV,EAAqBzE,YAArB,EAAmC;IAC1E;IACA;IACA;IACA,IAAIyE,SAAS,IAAIzE,YAAY,CAAC5B,KAA9B,EAAqC;MACnC,IAAIiH,SAAS,GAAGrF,YAAY,CAAChC,aAAb,CAA2BsH,QAA3B,CAAoC,CAAC,MAAD,EAAS,WAAT,CAApC,EAA2D/I,YAA3D,EAAhB,CADmC,CACwD;MAC3F;;MAEA,IAAIgJ,SAAS,GAAGF,SAAS,CAACG,OAA1B;;MAEA,KAAKd,iBAAL,CAAuBe,IAAvB,CAA4BC,QAA5B,CAAqC,UAAUZ,EAAV,EAAc;QACjD,IAAI,CAACA,EAAE,CAACa,OAAR,EAAiB;UACf;UACA;UACA,IAAAC,4BAAA,EAAqBd,EAArB;UACA,IAAIjI,KAAK,GAAGiI,EAAE,CAACe,WAAH,CAAe,MAAf,EAAuBhJ,KAAvB,IAAgC,EAA5C,CAJe,CAIiC;;UAEhD,IAAIA,KAAK,CAAC2I,OAAN,IAAiB,IAAjB,IAAyBD,SAAS,IAAI,IAA1C,EAAgD;YAC9C1I,KAAK,CAAC2I,OAAN,GAAgBD,SAAhB;UACD,CARc,CAQb;UACF;;;UAGAT,EAAE,CAACe,WAAH,CAAe,UAAf;QACD;MACF,CAfD;IAgBD;EACF,CA3BD;;EA6BA9I,OAAO,CAACe,SAAR,CAAkBgI,MAAlB,GAA2B,YAAY;IACrC,KAAKlI,aAAL,CAAmB4D,SAAnB;;IAEA,KAAKjB,mBAAL,GAA2B,IAA3B;;IAEA,KAAK1C,SAAL,CAAe2D,SAAf;;IAEA,KAAK6C,QAAL;;IAEA,KAAK/G,WAAL,CAAiByI,OAAjB;;IAEA,KAAKtI,eAAL,GAAuB,IAAvB;EACD,CAZD;;EAcAV,OAAO,CAACe,SAAR,CAAkBkI,uBAAlB,GAA4C,UAAUnE,IAAV,EAAgBoE,QAAhB,EAA0B;IACpE,IAAIpE,IAAI,IAAI,IAAZ,EAAkB;MAChB,OAAO,EAAP;IACD;;IAED,IAAIjD,GAAG,GAAGqH,QAAQ,CAACpH,gBAAnB;;IAEA,IAAID,GAAG,CAACqB,YAAJ,KAAqB,SAAzB,EAAoC;MAClC,IAAIK,kBAAkB,GAAG,KAAKC,mBAA9B;;MAEA,IAAID,kBAAJ,EAAwB;QACtB,IAAIwB,WAAW,GAAGxB,kBAAkB,CAAC7D,GAAnB,CAAuBoF,IAAvB,CAAlB;QACA,OAAOC,WAAW,GAAG,CAACA,WAAD,CAAH,GAAmB,EAArC;MACD;IACF,CAPD,MAOO,IAAIlD,GAAG,CAACqB,YAAJ,KAAqB,QAAzB,EAAmC;MACxC,OAAO,KAAKuE,iBAAL,IAA0B,KAAKA,iBAAL,CAAuB/H,GAAvB,CAA2BoF,IAA3B,CAA1B,IAA8D,EAArE;IACD;EACF,CAjBD;;EAmBA9E,OAAO,CAACe,SAAR,CAAkBsG,mBAAlB,GAAwC,UAAUF,OAAV,EAAmB;IACzD,OAAO,KAAKgC,WAAL,KAAqBhC,OAA5B;EACD,CAFD;;EAIAnH,OAAO,CAACe,SAAR,CAAkBwG,OAAlB,GAA4B,UAAUJ,OAAV,EAAmB;IAC7C,IAAIiC,QAAQ,GAAGC,yBAAA,CAAiBC,cAAjB,CAAgCnC,OAAhC,CAAf;;IAEA,IAAIiC,QAAQ,IAAIA,QAAQ,CAACzD,IAAT,KAAkB,QAAlC,EAA4C;MAC1C,IAAI4D,UAAU,GAAGH,QAAQ,CAACI,UAAT,CAAoB,KAAKnJ,GAAzB,CAAjB;;MAEA,KAAKS,SAAL,CAAeF,GAAf,CAAmB2I,UAAU,CAACb,IAA9B;;MAEA,KAAKf,iBAAL,GAAyB4B,UAAzB;MACA,KAAKJ,WAAL,GAAmBhC,OAAnB;IACD;EACF,CAXD;;EAaAnH,OAAO,CAACe,SAAR,CAAkBuG,QAAlB,GAA6B,YAAY;IACvC,IAAIH,OAAO,GAAG,KAAKgC,WAAnB;;IAEA,IAAIhC,OAAO,IAAI,IAAf,EAAqB;MACnB;IACD;;IAED,IAAIiC,QAAQ,GAAGC,yBAAA,CAAiBC,cAAjB,CAAgCnC,OAAhC,CAAf;;IAEA,IAAIiC,QAAQ,IAAIA,QAAQ,CAACzD,IAAT,KAAkB,QAAlC,EAA4C;MAC1CyD,QAAQ,CAACK,WAAT,CAAqB,KAAKpJ,GAA1B;IACD;;IAED,KAAKsH,iBAAL,GAAyB,IAAzB;IACA,KAAKF,iBAAL,GAAyB,IAAzB;;IAEA,KAAK3G,SAAL,CAAe2D,SAAf;;IAEA,KAAK0E,WAAL,GAAmB,IAAnB;EACD,CAnBD;;EAqBAnJ,OAAO,CAACe,SAAR,CAAkBsC,iBAAlB,GAAsC,UAAUpC,aAAV,EAAyBC,OAAzB,EAAkCjB,GAAlC,EAAuC;IAC3E,IAAI4B,GAAG,GAAGZ,aAAa,CAACa,gBAAxB;IACA,IAAI4H,UAAU,GAAG,KAAKnJ,WAAtB;IACA,IAAIoJ,cAAc,GAAG,KAAKjJ,eAA1B,CAH2E,CAGhC;;IAE3CiJ,cAAc,CAACC,SAAf,GAA2B3I,aAAa,CAACvB,GAAd,CAAkB,YAAlB,CAA3B;IACAiK,cAAc,CAACE,IAAf,GAAsBhI,GAAG,CAACiI,OAAJ,EAAtB,CAN2E,CAMtC;IACrC;;IAEAJ,UAAU,CAACK,MAAX,CAAkB9I,aAAa,CAACvB,GAAd,CAAkB,MAAlB,KAA6B,KAA/C;IACA,IAAI4B,QAAQ,GAAGL,aAAa,CAACK,QAA7B;;IAEA,SAAS0I,cAAT,GAA0B;MACxB,IAAIC,MAAM,GAAG;QACXtE,IAAI,EAAE,SADK;QAEXuE,aAAa,EAAE5I;MAFJ,CAAb;MAIA2I,MAAM,CAAC3I,QAAQ,GAAG,IAAZ,CAAN,GAA0BL,aAAa,CAACkJ,EAAxC;MACA,OAAOF,MAAP;IACD;;IAEDP,UAAU,CAACU,GAAX,CAAe,KAAf,EAAsBC,EAAtB,CAAyB,KAAzB,EAAgC,UAAUC,CAAV,EAAa;MAC3C,KAAKC,cAAL,GAAsB,KAAtB;MACAC,UAAU,CAACC,eAAX,CAA2Bd,cAA3B,EAA2CW,CAAC,CAACI,EAA7C,EAAiDJ,CAAC,CAACK,EAAnD;MACA1K,GAAG,CAAC2K,cAAJ,CAAmB9L,MAAM,CAAC+L,MAAP,CAAcb,cAAc,EAA5B,EAAgC;QACjDU,EAAE,EAAEJ,CAAC,CAACI,EAD2C;QAEjDC,EAAE,EAAEL,CAAC,CAACK,EAF2C;QAGjDG,SAAS,EAAE;UACTC,QAAQ,EAAE;QADD;MAHsC,CAAhC,CAAnB;IAOD,CAVD,EAUG,IAVH;IAWArB,UAAU,CAACU,GAAX,CAAe,MAAf,EAAuBC,EAAvB,CAA0B,MAA1B,EAAkC,UAAUC,CAAV,EAAa;MAC7C,KAAKC,cAAL,GAAsB,KAAtB;MACAC,UAAU,CAACQ,gBAAX,CAA4BrB,cAA5B,EAA4CW,CAAC,CAACW,KAA9C,EAAqDX,CAAC,CAACY,OAAvD,EAAgEZ,CAAC,CAACa,OAAlE;MACAlL,GAAG,CAAC2K,cAAJ,CAAmB9L,MAAM,CAAC+L,MAAP,CAAcb,cAAc,EAA5B,EAAgC;QACjDH,IAAI,EAAES,CAAC,CAACW,KADyC;QAEjDC,OAAO,EAAEZ,CAAC,CAACY,OAFsC;QAGjDC,OAAO,EAAEb,CAAC,CAACa,OAHsC;QAIjDL,SAAS,EAAE;UACTC,QAAQ,EAAE;QADD;MAJsC,CAAhC,CAAnB;IAQD,CAXD,EAWG,IAXH;IAYArB,UAAU,CAAC0B,iBAAX,CAA6B,UAAUd,CAAV,EAAa9H,CAAb,EAAgBC,CAAhB,EAAmB;MAC9C,OAAOZ,GAAG,CAACwJ,YAAJ,CAAiB,CAAC7I,CAAD,EAAIC,CAAJ,CAAjB,KAA4B,CAAC,IAAA6I,iCAAA,EAAoBhB,CAApB,EAAuBrK,GAAvB,EAA4BgB,aAA5B,CAApC;IACD,CAFD;EAGD,CA/CD;EAgDA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EAGEjB,OAAO,CAACe,SAAR,CAAkBwK,mBAAlB,GAAwC,YAAY;IAClD,KAAKrL,KAAL,CAAWyI,QAAX,CAAoB,UAAUZ,EAAV,EAAc;MAChC,IAAIyD,KAAK,GAAGzD,EAAE,CAAC0D,cAAH,EAAZ;;MAEA,IAAID,KAAJ,EAAW;QACTA,KAAK,CAACE,MAAN,GAAevM,WAAW,CAACqM,KAAD,CAAX,CAAmBE,MAAlC;MACD;IACF,CAND;EAOD,CARD;;EAUA1L,OAAO,CAACe,SAAR,CAAkBuC,uBAAlB,GAA4C,UAAUrC,aAAV,EAAyBc,YAAzB,EAAuC9B,GAAvC,EAA4CkB,QAA5C,EAAsD;IAChG,IAAIwK,OAAO,GAAG,IAAd;IACA5J,YAAY,CAACqI,GAAb,CAAiB,WAAjB;IACArI,YAAY,CAACqI,GAAb,CAAiB,OAAjB,EAHgG,CAGrE;;IAE3B,IAAInJ,aAAa,CAACvB,GAAd,CAAkB,cAAlB,CAAJ,EAAuC;MACrCqC,YAAY,CAACsI,EAAb,CAAgB,WAAhB,EAA6B,YAAY;QACvCsB,OAAO,CAACpB,cAAR,GAAyB,IAAzB;MACD,CAFD;MAGAxI,YAAY,CAACsI,EAAb,CAAgB,OAAhB,EAAyB,UAAUC,CAAV,EAAa;QACpC,IAAI,CAACqB,OAAO,CAACpB,cAAb,EAA6B;UAC3B;QACD;;QAEDoB,OAAO,CAACpB,cAAR,GAAyB,KAAzB;MACD,CAND;IAOD;EACF,CAjBD;;EAmBA,OAAOvK,OAAP;AACD,CA5cD,EAFA;;AAgdA;;AAEA,SAAS6G,yBAAT,CAAmC5D,YAAnC,EAAiD8E,EAAjD,EAAqD6D,SAArD,EAAgE1G,WAAhE,EAA6E;EAC3E;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAI2G,gBAAgB,GAAG3G,WAAW,CAACqD,QAAZ,CAAqB,WAArB,CAAvB;EACA,IAAIuD,kBAAkB,GAAG5G,WAAW,CAACqD,QAAZ,CAAqB,CAAC,UAAD,EAAa,WAAb,CAArB,CAAzB;EACA,IAAIwD,cAAc,GAAG7G,WAAW,CAACqD,QAAZ,CAAqB,CAAC,MAAD,EAAS,WAAT,CAArB,CAArB;EACA,IAAIyD,gBAAgB,GAAG9G,WAAW,CAACqD,QAAZ,CAAqB,CAAC,QAAD,EAAW,WAAX,CAArB,CAAvB,CAX2E,CAWL;EACtE;;EAEA,IAAI0D,WAAW,GAAG5M,iBAAiB,CAACwM,gBAAD,CAAnC;EACA,IAAIK,aAAa,GAAG7M,iBAAiB,CAACyM,kBAAD,CAArC;EACA,IAAIK,WAAW,GAAG9M,iBAAiB,CAAC2M,gBAAD,CAAnC;EACA,IAAI1D,SAAS,GAAGjJ,iBAAiB,CAAC0M,cAAD,CAAjC,CAjB2E,CAiBxB;;EAEnD,IAAIxK,IAAI,GAAG0B,YAAY,CAAC1B,IAAxB;;EAEA,IAAIA,IAAJ,EAAU;IACR;IACA;IACA;IACA,IAAIzB,KAAK,GAAGyB,IAAI,CAAC6K,aAAL,CAAmBR,SAAnB,EAA8B,OAA9B,CAAZ;IACA,IAAIS,KAAK,GAAG9K,IAAI,CAAC6K,aAAL,CAAmBR,SAAnB,EAA8B,OAA9B,CAAZ;;IAEA,IAAI3I,YAAY,CAACH,0BAAb,IAA2ChD,KAAK,CAACH,IAArD,EAA2D;MACzDsM,WAAW,CAACtM,IAAZ,GAAmBG,KAAK,CAACH,IAAzB;IACD;;IAED,IAAI0M,KAAJ,EAAW;MACTJ,WAAW,CAACI,KAAZ,GAAoB,IAAAC,qCAAA,EAA+BD,KAA/B,EAAsCpJ,YAAY,CAAChD,GAAnD,CAApB;IACD;EACF,CAnC0E,CAmCzE;EACF;;;EAGA8H,EAAE,CAACwE,QAAH,CAAYN,WAAZ;EACAlE,EAAE,CAACjI,KAAH,CAAS0M,aAAT,GAAyB,IAAzB;EACAzE,EAAE,CAACe,WAAH,CAAe,UAAf,EAA2BhJ,KAA3B,GAAmCoM,aAAnC;EACAnE,EAAE,CAACe,WAAH,CAAe,QAAf,EAAyBhJ,KAAzB,GAAiCqM,WAAjC;EACApE,EAAE,CAACe,WAAH,CAAe,MAAf,EAAuBhJ,KAAvB,GAA+BwI,SAA/B,CA3C2E,CA2CjC;;EAE1C,IAAAO,4BAAA,EAAqBd,EAArB;AACD;;AAED,SAASjB,mBAAT,CAA6B7D,YAA7B,EAA2C8E,EAA3C,EAA+ClD,UAA/C,EAA2DK,WAA3D,EAAwEjE,aAAxE,EAAuF;AACvFgE,OADA,EACS;AACTwH,OAFA,EAES;EACP,IAAIlL,IAAI,GAAG0B,YAAY,CAAC1B,IAAxB;EACA,IAAIF,KAAK,GAAG4B,YAAY,CAAC5B,KAAzB;EACA,IAAIqL,SAAS,GAAGnL,IAAI,IAAIoL,KAAK,CAACpL,IAAI,CAAC7B,GAAL,CAAS6B,IAAI,CAACqL,YAAL,CAAkB,OAAlB,CAAT,EAAqC3H,OAArC,CAAD,CAA7B;EACA,IAAI4H,UAAU,GAAGtL,IAAI,IAAIA,IAAI,CAACuL,aAAL,CAAmB7H,OAAnB,CAAzB,CAJO,CAI+C;EACtD;EACA;EACA;;EAEA,IAAI5D,KAAK,IAAIqL,SAAT,IAAsBG,UAAU,IAAIA,UAAU,CAACE,SAAnD,EAA8D;IAC5D,IAAIC,KAAK,GAAG,CAAC3L,KAAD,GAAS4D,OAAT,GAAmBJ,UAA/B;IACA,IAAIoI,YAAY,GAAG,KAAK,CAAxB,CAF4D,CAEjC;;IAE3B,IAAI,CAAC1L,IAAD,IAAS0D,OAAO,IAAI,CAAxB,EAA2B;MACzBgI,YAAY,GAAGhM,aAAf;IACD;;IAED,IAAIiM,gBAAgB,GAAGT,OAAO,GAAG;MAC/BU,MAAM,EAAE;QACNC,KAAK,EAAE,QADD;QAENC,aAAa,EAAE;MAFT;IADuB,CAAH,GAK1B,IALJ,CAR4D,CAalD;IACV;;IAEA,IAAAC,yBAAA,EAAcvF,EAAd,EAAkB,IAAAwF,gCAAA,EAAqBrI,WAArB,CAAlB,EAAqD;MACnD+H,YAAY,EAAEA,YADqC;MAEnDO,cAAc,EAAER,KAFmC;MAGnDS,WAAW,EAAE5I;IAHsC,CAArD,EAIGqI,gBAJH;IAKA,IAAIQ,MAAM,GAAG3F,EAAE,CAAC0D,cAAH,EAAb;;IAEA,IAAIiC,MAAJ,EAAY;MACVvO,WAAW,CAACuO,MAAD,CAAX,CAAoBhC,MAApB,GAA6BgC,MAAM,CAAChC,MAApC;;MAEA,IAAI3D,EAAE,CAAC4F,UAAH,IAAiBlB,OAArB,EAA8B;QAC5B;QACA,IAAImB,IAAI,GAAG7F,EAAE,CAAC8F,eAAH,GAAqBC,KAArB,EAAX,CAF4B,CAEa;QACzC;QACA;QACA;;QAEA/F,EAAE,CAAC4F,UAAH,CAAcI,UAAd,GAA2BH,IAA3B;QACA7F,EAAE,CAAC4F,UAAH,CAAcK,QAAd,GAAyB,CAAC,CAACvB,OAAO,CAAC,CAAD,CAAP,GAAamB,IAAI,CAACpL,CAAnB,IAAwBoL,IAAI,CAACK,KAA7B,GAAqC,GAArC,GAA2C,GAA5C,EAAiD,CAACxB,OAAO,CAAC,CAAD,CAAP,GAAamB,IAAI,CAACnL,CAAnB,IAAwBmL,IAAI,CAACM,MAA7B,GAAsC,GAAtC,GAA4C,GAA7F,CAAzB;MACD;IACF,CApC2D,CAoC1D;IACF;IACA;IACA;IACA;IACA;;;IAGAnG,EAAE,CAACoG,qBAAH,GAA2B,IAA3B;EACD,CA7CD,MA6CO;IACLpG,EAAE,CAACqG,iBAAH;IACArG,EAAE,CAACsG,gBAAH;IACAtG,EAAE,CAACoG,qBAAH,GAA2B,IAA3B;EACD;AACF;;AAED,SAASnH,0BAAT,CAAoC/D,YAApC,EAAkDqL,YAAlD,EAAgEzJ,UAAhE,EAA4EK,WAA5E,EAAyFjE,aAAzF,EAAwG;AACxGgE,OADA,EACS;EACP;EACA;EACA,IAAIhC,YAAY,CAAC1B,IAAjB,EAAuB;IACrB;IACA;IACA;IACA;IACA;IACA;IACA;IACA0B,YAAY,CAAC1B,IAAb,CAAkBgN,gBAAlB,CAAmCtJ,OAAnC,EAA4CqJ,YAA5C;EACD,CATD,CASE;EACF;EACA;EACA;EACA;EAbA,KAcK;IACD;IACA,IAAAE,qBAAA,EAAUF,YAAV,EAAwBG,SAAxB,GAAoC;MAClCvE,aAAa,EAAE,KADmB;MAElCwE,cAAc,EAAEzN,aAAa,CAACyN,cAFI;MAGlCC,QAAQ,EAAE1N,aAAa,CAACyN,cAHU;MAIlC5J,IAAI,EAAED,UAJ4B;MAKlCD,MAAM,EAAEM,WAAW,IAAIA,WAAW,CAAC0J,MAA3B,IAAqC;IALX,CAApC;EAOD;AACJ;;AAED,SAAS3H,qBAAT,CAA+BhE,YAA/B,EAA6C8E,EAA7C,EAAiDlD,UAAjD,EAA6DK,WAA7D,EAA0EjE,aAA1E,EAAyF;EACvF,IAAI,CAACgC,YAAY,CAAC1B,IAAlB,EAAwB;IACtBpB,OAAO,CAAC0O,gBAAR,CAAyB;MACvB9G,EAAE,EAAEA,EADmB;MAEvB+G,cAAc,EAAE7N,aAFO;MAGvB8N,QAAQ,EAAElK,UAHa;MAIvB;MACAmK,iBAAiB,EAAE9J,WAAW,CAACxF,GAAZ,CAAgB,SAAhB;IALI,CAAzB;EAOD;AACF;;AAED,SAASwH,0BAAT,CAAoCjE,YAApC,EAAkD8E,EAAlD,EAAsDlD,UAAtD,EAAkEK,WAAlE,EAA+EjE,aAA/E,EAA8F;EAC5F;EACA8G,EAAE,CAACkH,qBAAH,GAA2B,CAAC,CAAChO,aAAa,CAACvB,GAAd,CAAkB,cAAlB,CAA7B,CAF4F,CAE5B;;EAEhE,IAAIwP,aAAa,GAAGhK,WAAW,CAACqD,QAAZ,CAAqB,UAArB,CAApB;EACA,IAAI4G,KAAK,GAAGD,aAAa,CAACxP,GAAd,CAAkB,OAAlB,CAAZ;EACA,IAAA0P,2BAAA,EAAoBrH,EAApB,EAAwBoH,KAAxB,EAA+BD,aAAa,CAACxP,GAAd,CAAkB,WAAlB,CAA/B,EAA+DwP,aAAa,CAACxP,GAAd,CAAkB,UAAlB,CAA/D;;EAEA,IAAIuD,YAAY,CAAC5B,KAAjB,EAAwB;IACtB,IAAAgO,uCAAA,EAAgCtH,EAAhC,EAAoC9G,aAApC,EAAmD4D,UAAnD;EACD;;EAED,OAAOsK,KAAP;AACD;;AAED,SAASpJ,YAAT,CAAsBuJ,KAAtB,EAA6B;AAC7BC,YADA,EACchJ,MADd,EACsB;EACpB,IAAIiJ,QAAQ,GAAG,EAAf;EACA,IAAIC,OAAJ;;EAEA,SAASC,YAAT,GAAwB;IACtBD,OAAO,GAAG,EAAV;EACD;;EAED,SAASE,UAAT,GAAsB;IACpB,IAAIF,OAAO,CAACzM,MAAZ,EAAoB;MAClBwM,QAAQ,CAACnL,IAAT,CAAcoL,OAAd;MACAA,OAAO,GAAG,EAAV;IACD;EACF;;EAED,IAAI7L,MAAM,GAAG2L,YAAY,CAAC;IACxBK,YAAY,EAAEF,YADU;IAExBG,UAAU,EAAEF,UAFY;IAGxBG,SAAS,EAAEJ,YAHa;IAIxBK,OAAO,EAAEJ,UAJe;IAKxB7L,KAAK,EAAE,UAAUtB,CAAV,EAAaC,CAAb,EAAgB;MACrB;MACA,IAAIuN,QAAQ,CAACxN,CAAD,CAAR,IAAewN,QAAQ,CAACvN,CAAD,CAA3B,EAAgC;QAC9BgN,OAAO,CAACpL,IAAR,CAAa,CAAC7B,CAAD,EAAIC,CAAJ,CAAb;MACD;IACF,CAVuB;IAWxBwN,MAAM,EAAE,YAAY,CAAE;EAXE,CAAD,CAAzB;EAaA,CAAC1J,MAAD,IAAW3C,MAAM,CAACgM,YAAP,EAAX;EACA9Q,MAAM,CAAC4F,IAAP,CAAY4K,KAAZ,EAAmB,UAAUY,IAAV,EAAgB;IACjCtM,MAAM,CAACkM,SAAP;;IAEA,KAAK,IAAI3L,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+L,IAAI,CAAClN,MAAzB,EAAiCmB,CAAC,EAAlC,EAAsC;MACpCP,MAAM,CAACE,KAAP,CAAaoM,IAAI,CAAC/L,CAAD,CAAJ,CAAQ,CAAR,CAAb,EAAyB+L,IAAI,CAAC/L,CAAD,CAAJ,CAAQ,CAAR,CAAzB;IACD;;IAEDP,MAAM,CAACmM,OAAP;EACD,CARD;EASA,CAACxJ,MAAD,IAAW3C,MAAM,CAACiM,UAAP,EAAX;EACA,OAAOL,QAAP;AACD;;eAEcxP,O,EAAS"},"metadata":{},"sourceType":"script"}