{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/Z/Desktop/efficient/efficient/node_modules/@babel/runtime/helpers/interopRequireDefault.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _graphic = require(\"../util/graphic.js\");\n\nvar _innerStore = require(\"../util/innerStore.js\");\n\nvar _number = require(\"../util/number.js\");\n\nvar _Transformable = _interopRequireDefault(require(\"zrender/lib/core/Transformable.js\"));\n\nvar _labelGuideHelper = require(\"./labelGuideHelper.js\");\n\nvar _model = require(\"../util/model.js\");\n\nvar _util = require(\"zrender/lib/core/util.js\");\n\nvar _labelLayoutHelper = require(\"./labelLayoutHelper.js\");\n\nvar _labelStyle = require(\"./labelStyle.js\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// TODO: move labels out of viewport.\nfunction cloneArr(points) {\n  if (points) {\n    var newPoints = [];\n\n    for (var i = 0; i < points.length; i++) {\n      newPoints.push(points[i].slice());\n    }\n\n    return newPoints;\n  }\n}\n\nfunction prepareLayoutCallbackParams(labelItem, hostEl) {\n  var label = labelItem.label;\n  var labelLine = hostEl && hostEl.getTextGuideLine();\n  return {\n    dataIndex: labelItem.dataIndex,\n    dataType: labelItem.dataType,\n    seriesIndex: labelItem.seriesModel.seriesIndex,\n    text: labelItem.label.style.text,\n    rect: labelItem.hostRect,\n    labelRect: labelItem.rect,\n    // x: labelAttr.x,\n    // y: labelAttr.y,\n    align: label.style.align,\n    verticalAlign: label.style.verticalAlign,\n    labelLinePoints: cloneArr(labelLine && labelLine.shape.points)\n  };\n}\n\nvar LABEL_OPTION_TO_STYLE_KEYS = ['align', 'verticalAlign', 'width', 'height', 'fontSize'];\nvar dummyTransformable = new _Transformable.default();\nvar labelLayoutInnerStore = (0, _model.makeInner)();\nvar labelLineAnimationStore = (0, _model.makeInner)();\n\nfunction extendWithKeys(target, source, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n\n    if (source[key] != null) {\n      target[key] = source[key];\n    }\n  }\n}\n\nvar LABEL_LAYOUT_PROPS = ['x', 'y', 'rotation'];\n\nvar LabelManager =\n/** @class */\nfunction () {\n  function LabelManager() {\n    this._labelList = [];\n    this._chartViewList = [];\n  }\n\n  LabelManager.prototype.clearLabels = function () {\n    this._labelList = [];\n    this._chartViewList = [];\n  };\n  /**\n   * Add label to manager\n   */\n\n\n  LabelManager.prototype._addLabel = function (dataIndex, dataType, seriesModel, label, layoutOption) {\n    var labelStyle = label.style;\n    var hostEl = label.__hostTarget;\n    var textConfig = hostEl.textConfig || {}; // TODO: If label is in other state.\n\n    var labelTransform = label.getComputedTransform();\n    var labelRect = label.getBoundingRect().plain();\n\n    _graphic.BoundingRect.applyTransform(labelRect, labelRect, labelTransform);\n\n    if (labelTransform) {\n      dummyTransformable.setLocalTransform(labelTransform);\n    } else {\n      // Identity transform.\n      dummyTransformable.x = dummyTransformable.y = dummyTransformable.rotation = dummyTransformable.originX = dummyTransformable.originY = 0;\n      dummyTransformable.scaleX = dummyTransformable.scaleY = 1;\n    }\n\n    var host = label.__hostTarget;\n    var hostRect;\n\n    if (host) {\n      hostRect = host.getBoundingRect().plain();\n      var transform = host.getComputedTransform();\n\n      _graphic.BoundingRect.applyTransform(hostRect, hostRect, transform);\n    }\n\n    var labelGuide = hostRect && host.getTextGuideLine();\n\n    this._labelList.push({\n      label: label,\n      labelLine: labelGuide,\n      seriesModel: seriesModel,\n      dataIndex: dataIndex,\n      dataType: dataType,\n      layoutOption: layoutOption,\n      computedLayoutOption: null,\n      rect: labelRect,\n      hostRect: hostRect,\n      // Label with lower priority will be hidden when overlapped\n      // Use rect size as default priority\n      priority: hostRect ? hostRect.width * hostRect.height : 0,\n      // Save default label attributes.\n      // For restore if developers want get back to default value in callback.\n      defaultAttr: {\n        ignore: label.ignore,\n        labelGuideIgnore: labelGuide && labelGuide.ignore,\n        x: dummyTransformable.x,\n        y: dummyTransformable.y,\n        scaleX: dummyTransformable.scaleX,\n        scaleY: dummyTransformable.scaleY,\n        rotation: dummyTransformable.rotation,\n        style: {\n          x: labelStyle.x,\n          y: labelStyle.y,\n          align: labelStyle.align,\n          verticalAlign: labelStyle.verticalAlign,\n          width: labelStyle.width,\n          height: labelStyle.height,\n          fontSize: labelStyle.fontSize\n        },\n        cursor: label.cursor,\n        attachedPos: textConfig.position,\n        attachedRot: textConfig.rotation\n      }\n    });\n  };\n\n  LabelManager.prototype.addLabelsOfSeries = function (chartView) {\n    var _this = this;\n\n    this._chartViewList.push(chartView);\n\n    var seriesModel = chartView.__model;\n    var layoutOption = seriesModel.get('labelLayout');\n    /**\n     * Ignore layouting if it's not specified anything.\n     */\n\n    if (!((0, _util.isFunction)(layoutOption) || (0, _util.keys)(layoutOption).length)) {\n      return;\n    }\n\n    chartView.group.traverse(function (child) {\n      if (child.ignore) {\n        return true; // Stop traverse descendants.\n      } // Only support label being hosted on graphic elements.\n\n\n      var textEl = child.getTextContent();\n      var ecData = (0, _innerStore.getECData)(child); // Can only attach the text on the element with dataIndex\n\n      if (textEl && !textEl.disableLabelLayout) {\n        _this._addLabel(ecData.dataIndex, ecData.dataType, seriesModel, textEl, layoutOption);\n      }\n    });\n  };\n\n  LabelManager.prototype.updateLayoutConfig = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n\n    function createDragHandler(el, labelLineModel) {\n      return function () {\n        (0, _labelGuideHelper.updateLabelLinePoints)(el, labelLineModel);\n      };\n    }\n\n    for (var i = 0; i < this._labelList.length; i++) {\n      var labelItem = this._labelList[i];\n      var label = labelItem.label;\n      var hostEl = label.__hostTarget;\n      var defaultLabelAttr = labelItem.defaultAttr;\n      var layoutOption = void 0; // TODO A global layout option?\n\n      if ((0, _util.isFunction)(labelItem.layoutOption)) {\n        layoutOption = labelItem.layoutOption(prepareLayoutCallbackParams(labelItem, hostEl));\n      } else {\n        layoutOption = labelItem.layoutOption;\n      }\n\n      layoutOption = layoutOption || {};\n      labelItem.computedLayoutOption = layoutOption;\n      var degreeToRadian = Math.PI / 180; // TODO hostEl should always exists.\n      // Or label should not have parent because the x, y is all in global space.\n\n      if (hostEl) {\n        hostEl.setTextConfig({\n          // Force to set local false.\n          local: false,\n          // Ignore position and rotation config on the host el if x or y is changed.\n          position: layoutOption.x != null || layoutOption.y != null ? null : defaultLabelAttr.attachedPos,\n          // Ignore rotation config on the host el if rotation is changed.\n          rotation: layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.attachedRot,\n          offset: [layoutOption.dx || 0, layoutOption.dy || 0]\n        });\n      }\n\n      var needsUpdateLabelLine = false;\n\n      if (layoutOption.x != null) {\n        // TODO width of chart view.\n        label.x = (0, _number.parsePercent)(layoutOption.x, width);\n        label.setStyle('x', 0); // Ignore movement in style. TODO: origin.\n\n        needsUpdateLabelLine = true;\n      } else {\n        label.x = defaultLabelAttr.x;\n        label.setStyle('x', defaultLabelAttr.style.x);\n      }\n\n      if (layoutOption.y != null) {\n        // TODO height of chart view.\n        label.y = (0, _number.parsePercent)(layoutOption.y, height);\n        label.setStyle('y', 0); // Ignore movement in style.\n\n        needsUpdateLabelLine = true;\n      } else {\n        label.y = defaultLabelAttr.y;\n        label.setStyle('y', defaultLabelAttr.style.y);\n      }\n\n      if (layoutOption.labelLinePoints) {\n        var guideLine = hostEl.getTextGuideLine();\n\n        if (guideLine) {\n          guideLine.setShape({\n            points: layoutOption.labelLinePoints\n          }); // Not update\n\n          needsUpdateLabelLine = false;\n        }\n      }\n\n      var labelLayoutStore = labelLayoutInnerStore(label);\n      labelLayoutStore.needsUpdateLabelLine = needsUpdateLabelLine;\n      label.rotation = layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.rotation;\n      label.scaleX = defaultLabelAttr.scaleX;\n      label.scaleY = defaultLabelAttr.scaleY;\n\n      for (var k = 0; k < LABEL_OPTION_TO_STYLE_KEYS.length; k++) {\n        var key = LABEL_OPTION_TO_STYLE_KEYS[k];\n        label.setStyle(key, layoutOption[key] != null ? layoutOption[key] : defaultLabelAttr.style[key]);\n      }\n\n      if (layoutOption.draggable) {\n        label.draggable = true;\n        label.cursor = 'move';\n\n        if (hostEl) {\n          var hostModel = labelItem.seriesModel;\n\n          if (labelItem.dataIndex != null) {\n            var data = labelItem.seriesModel.getData(labelItem.dataType);\n            hostModel = data.getItemModel(labelItem.dataIndex);\n          }\n\n          label.on('drag', createDragHandler(hostEl, hostModel.getModel('labelLine')));\n        }\n      } else {\n        // TODO Other drag functions?\n        label.off('drag');\n        label.cursor = defaultLabelAttr.cursor;\n      }\n    }\n  };\n\n  LabelManager.prototype.layout = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n    var labelList = (0, _labelLayoutHelper.prepareLayoutList)(this._labelList);\n    var labelsNeedsAdjustOnX = (0, _util.filter)(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftX';\n    });\n    var labelsNeedsAdjustOnY = (0, _util.filter)(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftY';\n    });\n    (0, _labelLayoutHelper.shiftLayoutOnX)(labelsNeedsAdjustOnX, 0, width);\n    (0, _labelLayoutHelper.shiftLayoutOnY)(labelsNeedsAdjustOnY, 0, height);\n    var labelsNeedsHideOverlap = (0, _util.filter)(labelList, function (item) {\n      return item.layoutOption.hideOverlap;\n    });\n    (0, _labelLayoutHelper.hideOverlap)(labelsNeedsHideOverlap);\n  };\n  /**\n   * Process all labels. Not only labels with layoutOption.\n   */\n\n\n  LabelManager.prototype.processLabelsOverall = function () {\n    var _this = this;\n\n    (0, _util.each)(this._chartViewList, function (chartView) {\n      var seriesModel = chartView.__model;\n      var ignoreLabelLineUpdate = chartView.ignoreLabelLineUpdate;\n      var animationEnabled = seriesModel.isAnimationEnabled();\n      chartView.group.traverse(function (child) {\n        if (child.ignore && !child.forceLabelAnimation) {\n          return true; // Stop traverse descendants.\n        }\n\n        var needsUpdateLabelLine = !ignoreLabelLineUpdate;\n        var label = child.getTextContent();\n\n        if (!needsUpdateLabelLine && label) {\n          needsUpdateLabelLine = labelLayoutInnerStore(label).needsUpdateLabelLine;\n        }\n\n        if (needsUpdateLabelLine) {\n          _this._updateLabelLine(child, seriesModel);\n        }\n\n        if (animationEnabled) {\n          _this._animateLabels(child, seriesModel);\n        }\n      });\n    });\n  };\n\n  LabelManager.prototype._updateLabelLine = function (el, seriesModel) {\n    // Only support label being hosted on graphic elements.\n    var textEl = el.getTextContent(); // Update label line style.\n\n    var ecData = (0, _innerStore.getECData)(el);\n    var dataIndex = ecData.dataIndex; // Only support labelLine on the labels represent data.\n\n    if (textEl && dataIndex != null) {\n      var data = seriesModel.getData(ecData.dataType);\n      var itemModel = data.getItemModel(dataIndex);\n      var defaultStyle = {};\n      var visualStyle = data.getItemVisual(dataIndex, 'style');\n      var visualType = data.getVisual('drawType'); // Default to be same with main color\n\n      defaultStyle.stroke = visualStyle[visualType];\n      var labelLineModel = itemModel.getModel('labelLine');\n      (0, _labelGuideHelper.setLabelLineStyle)(el, (0, _labelGuideHelper.getLabelLineStatesModels)(itemModel), defaultStyle);\n      (0, _labelGuideHelper.updateLabelLinePoints)(el, labelLineModel);\n    }\n  };\n\n  LabelManager.prototype._animateLabels = function (el, seriesModel) {\n    var textEl = el.getTextContent();\n    var guideLine = el.getTextGuideLine(); // Animate\n\n    if (textEl // `forceLabelAnimation` has the highest priority\n    && (el.forceLabelAnimation || !textEl.ignore && !textEl.invisible && !el.disableLabelAnimation && !(0, _graphic.isElementRemoved)(el))) {\n      var layoutStore = labelLayoutInnerStore(textEl);\n      var oldLayout = layoutStore.oldLayout;\n      var ecData = (0, _innerStore.getECData)(el);\n      var dataIndex = ecData.dataIndex;\n      var newProps = {\n        x: textEl.x,\n        y: textEl.y,\n        rotation: textEl.rotation\n      };\n      var data = seriesModel.getData(ecData.dataType);\n\n      if (!oldLayout) {\n        textEl.attr(newProps); // Disable fade in animation if value animation is enabled.\n\n        if (!(0, _labelStyle.labelInner)(textEl).valueAnimation) {\n          var oldOpacity = (0, _util.retrieve2)(textEl.style.opacity, 1); // Fade in animation\n\n          textEl.style.opacity = 0;\n          (0, _graphic.initProps)(textEl, {\n            style: {\n              opacity: oldOpacity\n            }\n          }, seriesModel, dataIndex);\n        }\n      } else {\n        textEl.attr(oldLayout); // Make sure the animation from is in the right status.\n\n        var prevStates = el.prevStates;\n\n        if (prevStates) {\n          if ((0, _util.indexOf)(prevStates, 'select') >= 0) {\n            textEl.attr(layoutStore.oldLayoutSelect);\n          }\n\n          if ((0, _util.indexOf)(prevStates, 'emphasis') >= 0) {\n            textEl.attr(layoutStore.oldLayoutEmphasis);\n          }\n        }\n\n        (0, _graphic.updateProps)(textEl, newProps, seriesModel, dataIndex);\n      }\n\n      layoutStore.oldLayout = newProps;\n\n      if (textEl.states.select) {\n        var layoutSelect = layoutStore.oldLayoutSelect = {};\n        extendWithKeys(layoutSelect, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutSelect, textEl.states.select, LABEL_LAYOUT_PROPS);\n      }\n\n      if (textEl.states.emphasis) {\n        var layoutEmphasis = layoutStore.oldLayoutEmphasis = {};\n        extendWithKeys(layoutEmphasis, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutEmphasis, textEl.states.emphasis, LABEL_LAYOUT_PROPS);\n      }\n\n      (0, _labelStyle.animateLabelValue)(textEl, dataIndex, data, seriesModel, seriesModel);\n    }\n\n    if (guideLine && !guideLine.ignore && !guideLine.invisible) {\n      var layoutStore = labelLineAnimationStore(guideLine);\n      var oldLayout = layoutStore.oldLayout;\n      var newLayout = {\n        points: guideLine.shape.points\n      };\n\n      if (!oldLayout) {\n        guideLine.setShape(newLayout);\n        guideLine.style.strokePercent = 0;\n        (0, _graphic.initProps)(guideLine, {\n          style: {\n            strokePercent: 1\n          }\n        }, seriesModel);\n      } else {\n        guideLine.attr({\n          shape: oldLayout\n        });\n        (0, _graphic.updateProps)(guideLine, {\n          shape: newLayout\n        }, seriesModel);\n      }\n\n      layoutStore.oldLayout = newLayout;\n    }\n  };\n\n  return LabelManager;\n}();\n\nvar _default = LabelManager;\nexports.default = _default;","map":{"version":3,"names":["cloneArr","points","newPoints","i","length","push","slice","prepareLayoutCallbackParams","labelItem","hostEl","label","labelLine","getTextGuideLine","dataIndex","dataType","seriesIndex","seriesModel","text","style","rect","hostRect","labelRect","align","verticalAlign","labelLinePoints","shape","LABEL_OPTION_TO_STYLE_KEYS","dummyTransformable","Transformable","labelLayoutInnerStore","makeInner","labelLineAnimationStore","extendWithKeys","target","source","keys","key","LABEL_LAYOUT_PROPS","LabelManager","_labelList","_chartViewList","prototype","clearLabels","_addLabel","layoutOption","labelStyle","__hostTarget","textConfig","labelTransform","getComputedTransform","getBoundingRect","plain","BoundingRect","applyTransform","setLocalTransform","x","y","rotation","originX","originY","scaleX","scaleY","host","transform","labelGuide","computedLayoutOption","priority","width","height","defaultAttr","ignore","labelGuideIgnore","fontSize","cursor","attachedPos","position","attachedRot","addLabelsOfSeries","chartView","_this","__model","get","isFunction","group","traverse","child","textEl","getTextContent","ecData","getECData","disableLabelLayout","updateLayoutConfig","api","getWidth","getHeight","createDragHandler","el","labelLineModel","updateLabelLinePoints","defaultLabelAttr","degreeToRadian","Math","PI","setTextConfig","local","rotate","offset","dx","dy","needsUpdateLabelLine","parsePercent","setStyle","guideLine","setShape","labelLayoutStore","k","draggable","hostModel","data","getData","getItemModel","on","getModel","off","layout","labelList","prepareLayoutList","labelsNeedsAdjustOnX","filter","item","moveOverlap","labelsNeedsAdjustOnY","shiftLayoutOnX","shiftLayoutOnY","labelsNeedsHideOverlap","hideOverlap","processLabelsOverall","each","ignoreLabelLineUpdate","animationEnabled","isAnimationEnabled","forceLabelAnimation","_updateLabelLine","_animateLabels","itemModel","defaultStyle","visualStyle","getItemVisual","visualType","getVisual","stroke","setLabelLineStyle","getLabelLineStatesModels","invisible","disableLabelAnimation","isElementRemoved","layoutStore","oldLayout","newProps","attr","labelInner","valueAnimation","oldOpacity","retrieve2","opacity","initProps","prevStates","indexOf","oldLayoutSelect","oldLayoutEmphasis","updateProps","states","select","layoutSelect","emphasis","layoutEmphasis","animateLabelValue","newLayout","strokePercent"],"sources":["C:/Users/Z/Desktop/efficient/node_modules/echarts/lib/label/LabelManager.js"],"sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n// TODO: move labels out of viewport.\nimport { BoundingRect, updateProps, initProps, isElementRemoved } from '../util/graphic.js';\nimport { getECData } from '../util/innerStore.js';\nimport { parsePercent } from '../util/number.js';\nimport Transformable from 'zrender/lib/core/Transformable.js';\nimport { updateLabelLinePoints, setLabelLineStyle, getLabelLineStatesModels } from './labelGuideHelper.js';\nimport { makeInner } from '../util/model.js';\nimport { retrieve2, each, keys, isFunction, filter, indexOf } from 'zrender/lib/core/util.js';\nimport { prepareLayoutList, hideOverlap, shiftLayoutOnX, shiftLayoutOnY } from './labelLayoutHelper.js';\nimport { labelInner, animateLabelValue } from './labelStyle.js';\n\nfunction cloneArr(points) {\n  if (points) {\n    var newPoints = [];\n\n    for (var i = 0; i < points.length; i++) {\n      newPoints.push(points[i].slice());\n    }\n\n    return newPoints;\n  }\n}\n\nfunction prepareLayoutCallbackParams(labelItem, hostEl) {\n  var label = labelItem.label;\n  var labelLine = hostEl && hostEl.getTextGuideLine();\n  return {\n    dataIndex: labelItem.dataIndex,\n    dataType: labelItem.dataType,\n    seriesIndex: labelItem.seriesModel.seriesIndex,\n    text: labelItem.label.style.text,\n    rect: labelItem.hostRect,\n    labelRect: labelItem.rect,\n    // x: labelAttr.x,\n    // y: labelAttr.y,\n    align: label.style.align,\n    verticalAlign: label.style.verticalAlign,\n    labelLinePoints: cloneArr(labelLine && labelLine.shape.points)\n  };\n}\n\nvar LABEL_OPTION_TO_STYLE_KEYS = ['align', 'verticalAlign', 'width', 'height', 'fontSize'];\nvar dummyTransformable = new Transformable();\nvar labelLayoutInnerStore = makeInner();\nvar labelLineAnimationStore = makeInner();\n\nfunction extendWithKeys(target, source, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n\n    if (source[key] != null) {\n      target[key] = source[key];\n    }\n  }\n}\n\nvar LABEL_LAYOUT_PROPS = ['x', 'y', 'rotation'];\n\nvar LabelManager =\n/** @class */\nfunction () {\n  function LabelManager() {\n    this._labelList = [];\n    this._chartViewList = [];\n  }\n\n  LabelManager.prototype.clearLabels = function () {\n    this._labelList = [];\n    this._chartViewList = [];\n  };\n  /**\n   * Add label to manager\n   */\n\n\n  LabelManager.prototype._addLabel = function (dataIndex, dataType, seriesModel, label, layoutOption) {\n    var labelStyle = label.style;\n    var hostEl = label.__hostTarget;\n    var textConfig = hostEl.textConfig || {}; // TODO: If label is in other state.\n\n    var labelTransform = label.getComputedTransform();\n    var labelRect = label.getBoundingRect().plain();\n    BoundingRect.applyTransform(labelRect, labelRect, labelTransform);\n\n    if (labelTransform) {\n      dummyTransformable.setLocalTransform(labelTransform);\n    } else {\n      // Identity transform.\n      dummyTransformable.x = dummyTransformable.y = dummyTransformable.rotation = dummyTransformable.originX = dummyTransformable.originY = 0;\n      dummyTransformable.scaleX = dummyTransformable.scaleY = 1;\n    }\n\n    var host = label.__hostTarget;\n    var hostRect;\n\n    if (host) {\n      hostRect = host.getBoundingRect().plain();\n      var transform = host.getComputedTransform();\n      BoundingRect.applyTransform(hostRect, hostRect, transform);\n    }\n\n    var labelGuide = hostRect && host.getTextGuideLine();\n\n    this._labelList.push({\n      label: label,\n      labelLine: labelGuide,\n      seriesModel: seriesModel,\n      dataIndex: dataIndex,\n      dataType: dataType,\n      layoutOption: layoutOption,\n      computedLayoutOption: null,\n      rect: labelRect,\n      hostRect: hostRect,\n      // Label with lower priority will be hidden when overlapped\n      // Use rect size as default priority\n      priority: hostRect ? hostRect.width * hostRect.height : 0,\n      // Save default label attributes.\n      // For restore if developers want get back to default value in callback.\n      defaultAttr: {\n        ignore: label.ignore,\n        labelGuideIgnore: labelGuide && labelGuide.ignore,\n        x: dummyTransformable.x,\n        y: dummyTransformable.y,\n        scaleX: dummyTransformable.scaleX,\n        scaleY: dummyTransformable.scaleY,\n        rotation: dummyTransformable.rotation,\n        style: {\n          x: labelStyle.x,\n          y: labelStyle.y,\n          align: labelStyle.align,\n          verticalAlign: labelStyle.verticalAlign,\n          width: labelStyle.width,\n          height: labelStyle.height,\n          fontSize: labelStyle.fontSize\n        },\n        cursor: label.cursor,\n        attachedPos: textConfig.position,\n        attachedRot: textConfig.rotation\n      }\n    });\n  };\n\n  LabelManager.prototype.addLabelsOfSeries = function (chartView) {\n    var _this = this;\n\n    this._chartViewList.push(chartView);\n\n    var seriesModel = chartView.__model;\n    var layoutOption = seriesModel.get('labelLayout');\n    /**\n     * Ignore layouting if it's not specified anything.\n     */\n\n    if (!(isFunction(layoutOption) || keys(layoutOption).length)) {\n      return;\n    }\n\n    chartView.group.traverse(function (child) {\n      if (child.ignore) {\n        return true; // Stop traverse descendants.\n      } // Only support label being hosted on graphic elements.\n\n\n      var textEl = child.getTextContent();\n      var ecData = getECData(child); // Can only attach the text on the element with dataIndex\n\n      if (textEl && !textEl.disableLabelLayout) {\n        _this._addLabel(ecData.dataIndex, ecData.dataType, seriesModel, textEl, layoutOption);\n      }\n    });\n  };\n\n  LabelManager.prototype.updateLayoutConfig = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n\n    function createDragHandler(el, labelLineModel) {\n      return function () {\n        updateLabelLinePoints(el, labelLineModel);\n      };\n    }\n\n    for (var i = 0; i < this._labelList.length; i++) {\n      var labelItem = this._labelList[i];\n      var label = labelItem.label;\n      var hostEl = label.__hostTarget;\n      var defaultLabelAttr = labelItem.defaultAttr;\n      var layoutOption = void 0; // TODO A global layout option?\n\n      if (isFunction(labelItem.layoutOption)) {\n        layoutOption = labelItem.layoutOption(prepareLayoutCallbackParams(labelItem, hostEl));\n      } else {\n        layoutOption = labelItem.layoutOption;\n      }\n\n      layoutOption = layoutOption || {};\n      labelItem.computedLayoutOption = layoutOption;\n      var degreeToRadian = Math.PI / 180; // TODO hostEl should always exists.\n      // Or label should not have parent because the x, y is all in global space.\n\n      if (hostEl) {\n        hostEl.setTextConfig({\n          // Force to set local false.\n          local: false,\n          // Ignore position and rotation config on the host el if x or y is changed.\n          position: layoutOption.x != null || layoutOption.y != null ? null : defaultLabelAttr.attachedPos,\n          // Ignore rotation config on the host el if rotation is changed.\n          rotation: layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.attachedRot,\n          offset: [layoutOption.dx || 0, layoutOption.dy || 0]\n        });\n      }\n\n      var needsUpdateLabelLine = false;\n\n      if (layoutOption.x != null) {\n        // TODO width of chart view.\n        label.x = parsePercent(layoutOption.x, width);\n        label.setStyle('x', 0); // Ignore movement in style. TODO: origin.\n\n        needsUpdateLabelLine = true;\n      } else {\n        label.x = defaultLabelAttr.x;\n        label.setStyle('x', defaultLabelAttr.style.x);\n      }\n\n      if (layoutOption.y != null) {\n        // TODO height of chart view.\n        label.y = parsePercent(layoutOption.y, height);\n        label.setStyle('y', 0); // Ignore movement in style.\n\n        needsUpdateLabelLine = true;\n      } else {\n        label.y = defaultLabelAttr.y;\n        label.setStyle('y', defaultLabelAttr.style.y);\n      }\n\n      if (layoutOption.labelLinePoints) {\n        var guideLine = hostEl.getTextGuideLine();\n\n        if (guideLine) {\n          guideLine.setShape({\n            points: layoutOption.labelLinePoints\n          }); // Not update\n\n          needsUpdateLabelLine = false;\n        }\n      }\n\n      var labelLayoutStore = labelLayoutInnerStore(label);\n      labelLayoutStore.needsUpdateLabelLine = needsUpdateLabelLine;\n      label.rotation = layoutOption.rotate != null ? layoutOption.rotate * degreeToRadian : defaultLabelAttr.rotation;\n      label.scaleX = defaultLabelAttr.scaleX;\n      label.scaleY = defaultLabelAttr.scaleY;\n\n      for (var k = 0; k < LABEL_OPTION_TO_STYLE_KEYS.length; k++) {\n        var key = LABEL_OPTION_TO_STYLE_KEYS[k];\n        label.setStyle(key, layoutOption[key] != null ? layoutOption[key] : defaultLabelAttr.style[key]);\n      }\n\n      if (layoutOption.draggable) {\n        label.draggable = true;\n        label.cursor = 'move';\n\n        if (hostEl) {\n          var hostModel = labelItem.seriesModel;\n\n          if (labelItem.dataIndex != null) {\n            var data = labelItem.seriesModel.getData(labelItem.dataType);\n            hostModel = data.getItemModel(labelItem.dataIndex);\n          }\n\n          label.on('drag', createDragHandler(hostEl, hostModel.getModel('labelLine')));\n        }\n      } else {\n        // TODO Other drag functions?\n        label.off('drag');\n        label.cursor = defaultLabelAttr.cursor;\n      }\n    }\n  };\n\n  LabelManager.prototype.layout = function (api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n    var labelList = prepareLayoutList(this._labelList);\n    var labelsNeedsAdjustOnX = filter(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftX';\n    });\n    var labelsNeedsAdjustOnY = filter(labelList, function (item) {\n      return item.layoutOption.moveOverlap === 'shiftY';\n    });\n    shiftLayoutOnX(labelsNeedsAdjustOnX, 0, width);\n    shiftLayoutOnY(labelsNeedsAdjustOnY, 0, height);\n    var labelsNeedsHideOverlap = filter(labelList, function (item) {\n      return item.layoutOption.hideOverlap;\n    });\n    hideOverlap(labelsNeedsHideOverlap);\n  };\n  /**\n   * Process all labels. Not only labels with layoutOption.\n   */\n\n\n  LabelManager.prototype.processLabelsOverall = function () {\n    var _this = this;\n\n    each(this._chartViewList, function (chartView) {\n      var seriesModel = chartView.__model;\n      var ignoreLabelLineUpdate = chartView.ignoreLabelLineUpdate;\n      var animationEnabled = seriesModel.isAnimationEnabled();\n      chartView.group.traverse(function (child) {\n        if (child.ignore && !child.forceLabelAnimation) {\n          return true; // Stop traverse descendants.\n        }\n\n        var needsUpdateLabelLine = !ignoreLabelLineUpdate;\n        var label = child.getTextContent();\n\n        if (!needsUpdateLabelLine && label) {\n          needsUpdateLabelLine = labelLayoutInnerStore(label).needsUpdateLabelLine;\n        }\n\n        if (needsUpdateLabelLine) {\n          _this._updateLabelLine(child, seriesModel);\n        }\n\n        if (animationEnabled) {\n          _this._animateLabels(child, seriesModel);\n        }\n      });\n    });\n  };\n\n  LabelManager.prototype._updateLabelLine = function (el, seriesModel) {\n    // Only support label being hosted on graphic elements.\n    var textEl = el.getTextContent(); // Update label line style.\n\n    var ecData = getECData(el);\n    var dataIndex = ecData.dataIndex; // Only support labelLine on the labels represent data.\n\n    if (textEl && dataIndex != null) {\n      var data = seriesModel.getData(ecData.dataType);\n      var itemModel = data.getItemModel(dataIndex);\n      var defaultStyle = {};\n      var visualStyle = data.getItemVisual(dataIndex, 'style');\n      var visualType = data.getVisual('drawType'); // Default to be same with main color\n\n      defaultStyle.stroke = visualStyle[visualType];\n      var labelLineModel = itemModel.getModel('labelLine');\n      setLabelLineStyle(el, getLabelLineStatesModels(itemModel), defaultStyle);\n      updateLabelLinePoints(el, labelLineModel);\n    }\n  };\n\n  LabelManager.prototype._animateLabels = function (el, seriesModel) {\n    var textEl = el.getTextContent();\n    var guideLine = el.getTextGuideLine(); // Animate\n\n    if (textEl // `forceLabelAnimation` has the highest priority\n    && (el.forceLabelAnimation || !textEl.ignore && !textEl.invisible && !el.disableLabelAnimation && !isElementRemoved(el))) {\n      var layoutStore = labelLayoutInnerStore(textEl);\n      var oldLayout = layoutStore.oldLayout;\n      var ecData = getECData(el);\n      var dataIndex = ecData.dataIndex;\n      var newProps = {\n        x: textEl.x,\n        y: textEl.y,\n        rotation: textEl.rotation\n      };\n      var data = seriesModel.getData(ecData.dataType);\n\n      if (!oldLayout) {\n        textEl.attr(newProps); // Disable fade in animation if value animation is enabled.\n\n        if (!labelInner(textEl).valueAnimation) {\n          var oldOpacity = retrieve2(textEl.style.opacity, 1); // Fade in animation\n\n          textEl.style.opacity = 0;\n          initProps(textEl, {\n            style: {\n              opacity: oldOpacity\n            }\n          }, seriesModel, dataIndex);\n        }\n      } else {\n        textEl.attr(oldLayout); // Make sure the animation from is in the right status.\n\n        var prevStates = el.prevStates;\n\n        if (prevStates) {\n          if (indexOf(prevStates, 'select') >= 0) {\n            textEl.attr(layoutStore.oldLayoutSelect);\n          }\n\n          if (indexOf(prevStates, 'emphasis') >= 0) {\n            textEl.attr(layoutStore.oldLayoutEmphasis);\n          }\n        }\n\n        updateProps(textEl, newProps, seriesModel, dataIndex);\n      }\n\n      layoutStore.oldLayout = newProps;\n\n      if (textEl.states.select) {\n        var layoutSelect = layoutStore.oldLayoutSelect = {};\n        extendWithKeys(layoutSelect, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutSelect, textEl.states.select, LABEL_LAYOUT_PROPS);\n      }\n\n      if (textEl.states.emphasis) {\n        var layoutEmphasis = layoutStore.oldLayoutEmphasis = {};\n        extendWithKeys(layoutEmphasis, newProps, LABEL_LAYOUT_PROPS);\n        extendWithKeys(layoutEmphasis, textEl.states.emphasis, LABEL_LAYOUT_PROPS);\n      }\n\n      animateLabelValue(textEl, dataIndex, data, seriesModel, seriesModel);\n    }\n\n    if (guideLine && !guideLine.ignore && !guideLine.invisible) {\n      var layoutStore = labelLineAnimationStore(guideLine);\n      var oldLayout = layoutStore.oldLayout;\n      var newLayout = {\n        points: guideLine.shape.points\n      };\n\n      if (!oldLayout) {\n        guideLine.setShape(newLayout);\n        guideLine.style.strokePercent = 0;\n        initProps(guideLine, {\n          style: {\n            strokePercent: 1\n          }\n        }, seriesModel);\n      } else {\n        guideLine.attr({\n          shape: oldLayout\n        });\n        updateProps(guideLine, {\n          shape: newLayout\n        }, seriesModel);\n      }\n\n      layoutStore.oldLayout = newLayout;\n    }\n  };\n\n  return LabelManager;\n}();\n\nexport default LabelManager;"],"mappings":"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"},"metadata":{},"sourceType":"script"}